<!DOCTYPE html>
<html lang="en">

<head>

    <!--Firebase-->

    <script src="https://www.gstatic.com/firebasejs/5.9.1/firebase.js"></script>
    <script>
        // Initialize Firebase
        var config = {
            apiKey: "AIzaSyCW2DTUu_qEhCG9xpj5gGkG2_QC_CmsGQE",
            authDomain: "getconnected-9dac0.firebaseapp.com",
            databaseURL: "https://getconnected-9dac0.firebaseio.com",
            projectId: "getconnected-9dac0",
            storageBucket: "getconnected-9dac0.appspot.com",
            messagingSenderId: "144309081376"
        };
        firebase.initializeApp(config);
    </script>

    <!--*HEAD* 1. Title-->

    <title>{{ n }}</title>

    <!--*HEAD* 2. Bootstrap & CSS Links-->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="../GC_Auth/static/GC_Auth/loginstyle.css">


    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>

    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <link href="../../assets/css/ie10-viewport-bug-workaround.css" rel="stylesheet">

    <!-- footer style -->
    <link href="sticky-footer.css" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

    <!--Dropdown Notifications-->

    <style>

        .dropdown {
            display: inline-block;
            margin-left: 20px;
        }

        .notifications {
            min-width: 320px;
        }

        .notifications-wrapper {
            overflow: auto;
            max-height: 250px;

        }

        .notifications a.content {
            text-decoration: none;
            background: white;
        }

        /*Each item on the notification dropdown*/

        .notification-item {
            padding: 5px;
            margin: 5px;
            border-radius: 4px;
            border-width: 5px;
            border-color: black;
            height: 80px;
        }

        /*Image on dropdown notification*/
        .profile_img {
            width: 50px;
            display: inline;
            float: left;
            border: 0px solid #111;
            border-radius: 25px;
            box-shadow: 0 0 3px rgba(0, 0, 0, 0.5) inset;
            margin-right: -20px;

        }


    </style>

    <!--Page format + wallaper + oage container-->

    <style>


        .profileContainerDetails .UserWallpaper {
            height: 380px;
            background-position: center;
        }

        .UserWallpaper {
            height: 100vh;
            background-size: cover;
            margin: 0;
            padding: 0;
            border: 0;
            display: flex;
            align-items: center;

        }

        .parallax {
            /* Parallax effect for image wallpaper */
            background-attachment: fixed;
            background-position: center;
            background-repeat: no-repeat;
            background-size: cover;
        }

        .profileContainerLift {
            margin: -280px 30px 0; /* Up and down control */
            border-radius: 8px;
            box-shadow: 0 16px 24px 2px rgba(0, 0, 0, .14), 0 6px 30px 5px rgba(0, 0, 0, .12), 0 8px 10px -5px rgba(0, 0, 0, .2);
            height: 630px;
            margin-bottom: 30px;
        }

        .profileContainer { /* Container Control */
            background: #FFF;
            position: relative;
            z-index: 3;
        }

        .profileContainerDetails .profile img {
            max-width: 160px;
            width: 100%;
            margin: 0 auto;
            -webkit-transform: translate3d(0, -50%, 0);
            -moz-transform: translate3d(0, -50%, 0);
            -o-transform: translate3d(0, -50%, 0);
            -ms-transform: translate3d(0, -50%, 0);
            transform: translate3d(0, -50%, 0);
        }

        .img-raised { /* Profile Picture 1/3 */
            box-shadow: 0 5px 15px -8px rgba(0, 0, 0, .24), 0 8px 10px -5px rgba(0, 0, 0, .2);

        }

        .avatar:hover .changeImageLabel {
            opacity: 0.9;
            display: inline-block;
        }

        .rounded-circle { /* Profile Picture 2/3 */
            border-radius: 50% !important;
        }


        .img-fluid { /* Profile Picture 3/3 */
            max-width: 100%;
            max-height: 160px;
        }

        .profileContainerDetails .description {
            margin: 1.071rem auto 0;
            max-width: 600px;
            color: #999;
            font-weight: 300;
        }

        .profileContainerDetails {
            max-width: 100%;
            overflow-x: hidden;
        }

        .profileContainerDetails .gallery img {
            width: 100%;
            margin-bottom: 2.142rem;
        }

        .profileContainerDetails .profile .name {
            margin-top: -80px;
        }


    </style>

    <!-- 1.4. Cards Style-->

    <style>

        .col-sm-3 .rightColumnContainer_lower:hover {
            -ms-transform: scale(1); /* IE 9 */
            -webkit-transform: scale(1); /* Safari 3-8 */
            transform: scale(1);
            background-color: #e83e8c;
            color: white;
        }

        .titlefont {
            font-size: medium;
            color: gray;
            margin: auto 40px auto 40px;
            position: relative;
            left: 14px;
        }


        .card {
            box-shadow: 0 4px 8px 0 silver;
            width: 180px;
            height: 140px;
        }

        .card.hovercard {
            overflow: hidden;
            text-align: center;
            background-color: white;
            border-width: 5px;
            border-radius: 10px;

        }

        .card.hovercard:hover {
            overflow: hidden;
            text-align: center;
            background-color: white;
            border-width: 5px;

            -ms-transform: scale(0.5); /* IE 9 */
            -webkit-transform: scale(1); /* Safari 3-8 */
            transform: scale(1);
            border: 1px solid silver;
        }

        .card.Ccard {
            position: relative;
            overflow: hidden;
            text-align: center;
            background-color: white;
            border-width: 5px;

            width: 255px; /* or whatever width you want. */
            max-width: 255px; /* or whatever width you want. */
            height: 275px;
            max-height: 275px;
            display: inline-block;

            border-radius: 10px
        }

        .card.Ccard .info .title {
            margin-bottom: 4px;
            font-size: 24px;
            line-height: 1;
            color: black;
            vertical-align: middle;
            font-family: Arial;
        }

        .card.Ccard:hover {
            -ms-transform: scale(1); /* IE 9 */
            -webkit-transform: scale(1); /* Safari 3-8 */
            transform: scale(1);
            border: 1px solid silver;
            box-shadow: 5px 10px 8px #888888;
        }

        .cardheader {
            background: url("http://lorempixel.com/850/280/nature/4/");
            background-size: cover;
            height: 100px;
            width: 200px;
            border-radius: 8px;


            box-shadow: 0 4px 8px 0 silver;

        }

        .heartbutton {
            background: transparent;
            position: relative;
            top: -100px;
            left: 180px;

        }


        .heartColour {
            color: #e83e8c;
            border: black;
            border-width: 2px
        }

        .viewForum {
            color: #e83e8c;
            border: black;
            border-width: 2px
        }

        .ViewMorebutton {
            border-radius: 8px;
            color: white;
            background-color: #e83e8c;
            box-shadow: 0 0 3px rgba(0, 0, 0, 0.1) inset;
            opacity: 0.8;
            padding-top: 3px;
            padding-bottom: 3px;
            padding-left: 5px;
            padding-right: 5px;
            font-size: 12px;
            font-weight: bold;
        }

        .ViewMorebutton:hover {
            background-color: grey;
            color: black;
        }

        .AcceptDeclinebutton {
            border-radius: 8px;
            box-shadow: 0 0 3px rgba(0, 0, 0, 0.1) inset;
            opacity: 0.8;
            padding-top: 3px;
            padding-bottom: 3px;
            padding-left: 5px;
            padding-right: 5px;
            font-size: 12px;
            font-weight: bold;
            background-color: black;
        }

        .AcceptDeclinebutton:hover {
            background-color: #e83e8c;
            color: black;

        }

        /*footer logo*/
        footer img {
            width: 200%;
            height: 200%;
            text-align: left;
        }


        /*zoom features*/
        .zoom:hover {
            -ms-transform: scale(1); /* IE 9 */
            -webkit-transform: scale(1); /* Safari 3-8 */
            transform: scale(1);
            border: 1px solid silver;
            box-shadow: 5px 10px 8px #888888;
        }

        .well a:hover {
            text-decoration: none;
        }

        /*this is used for the hover over the badges to show badge details*/
        .middle {
            transition: .5s ease;
            opacity: 0;
            position: absolute;
            top: 80%;
            left: 100%;
            transform: translate(-50%, -50%);
            -ms-transform: translate(-50%, -50%);
            text-align: center;
            height: 50px;
            width: 200px;
        }

        /*this is also used for the hover over the badges*/
        .badgehover {
            position: relative;
            width: 50%;
        }

        /*for the badge hover*/
        .badgehover:hover .image {
            opacity: 0.3;
        }

        /*for the badge hover */
        .badgehover:hover .middle {
            opacity: 1;
        }

        /*the text when you hover over a badge*/
        .text {
            background-color: #e83e8c;
            opacity: 0.8;
            color: white;
            font-size: 16px;
            text-align: center;
            font-family: 'Roboto', sans-serif;

        }

    </style>


    <!--User profile page-->
    <style>

        .badges {
            position: absolute;
            top: -30px;
            left: 470px;
            box-shadow: 0 0 3px rgba(0, 0, 0, 0.1) inset;
            background-color: white;
            border-radius: 10px;
        }

        .badges_plus {
            box-shadow: 0 0 3px rgba(0, 0, 0, 0.1) inset;
            background-color: white;
            border-radius: 10px;
            border-color: white;
        }

        .plus:hover {
            -ms-transform: scale(0.5); /* IE 9 */
            -webkit-transform: scale(1); /* Safari 3-8 */
            transform: scale(1);
            border: 1px solid silver;
            border-radius: 23px;
        }

        .badges:hover {

            -ms-transform: scale(0.5); /* IE 9 */
            -webkit-transform: scale(1); /* Safari 3-8 */
            transform: scale(1);
            border: 1px solid silver;
        }

        .badges_plus:hover {

            -ms-transform: scale(0.5); /* IE 9 */
            -webkit-transform: scale(1); /* Safari 3-8 */
            transform: scale(1);
            border: 1px solid silver;
            border-radius: 23px;
        }

        .plus {
        }


        .settings {

        }

        .settings:hover {
            -ms-transform: scale(0.5); /* IE 9 */
            -webkit-transform: scale(1); /* Safari 3-8 */
            transform: scale(1);
            border: 1px solid white;
            border-radius: 23px;;
        }

        .main-secction {
            box-shadow: 5px 5px 5px;
            border-radius: 8px;

        }

        .image-section {
            padding: 0px;
        }

        .image-section img {
            width: 100%;
            height: 250px;
            position: relative;
        }


        .user-left-part {
            margin: 0px;
        }

        .user-image img {
            width: 100px;
            height: 100px;
        }


        .user-detail-section2 {
            font-size: 12px;
            padding: 0px;
            margin: 0px;
        }


        .user-detail-section2 span {
            color: #7CBBC3;
            font-size: 20px;
        }

        .user-detail-section2 small {
            font-size: 12px;
            color: #D3A86A;
        }

        .profile-right-section {
            padding: 20px 0px 10px 15px;
            background-color: #FFFFFF;
        }

        .profile-right-section-row {
            margin: 0px;
        }

        .profile-header-section1 h1 {
            font-size: 25px;
            margin: 0px;
        }

        .profile-header-section1 h5 {
            color: #0062cc;
        }


        .profile-tag {
            font-size: 12px;
            color: black;
        }

        .profile-tag i {
            color: #ADADAD;
            font-size: 20px;
        }


        .rightColumn {
            background-color: #FCFCFC;
            border-radius: 8px;
            box-shadow: 0 0 3px rgba(0, 0, 0, 0.1) inset;
            width: 290px;
            margin-left: 570px;
            margin-top: -133px;
            height: 300px;


        }

        .rightColumnTwo {
            background-color: #FCFCFC;
            border-radius: 8px;
            box-shadow: 0 0 3px rgba(0, 0, 0, 0.1) inset;
            width: 290px;
            margin-left: 570px;
            margin-top: 20px;
            height: 225px;

        }

        .rightColumnContainer {
            box-shadow: 0 0 3px rgba(0, 0, 0, 0.5) inset;
            border-radius: 8px;
            height: 72px;
            width: 280px;
            position: relative;
            right: 25px;
            top: -5px
        }

        .rightColumnContainer:hover {
            overflow: hidden;
            -ms-transform: scale(1); /* IE 9 */
            -webkit-transform: scale(1); /* Safari 3-8 */
            transform: scale(1);
            border: 1px solid silver;
            box-shadow: 5px 10px 8px #888888;
        }

        .rightColumnContainer_lower {
            box-shadow: 0 0 3px rgba(0, 0, 0, 0.5) inset;
            border-radius: 8px;
            height: 72px;
            width: 280px;
            position: relative;
            left: 5px;
            top: -5px;

        }


        .rightColumnfont {
            color: gray;
            position: relative;
            left: -9px;
            font-weight: bold;
            top: 6px;
            font-size: small;
        }


        .connection_container {
            margin-left: 40px;
        }


        .image-right-detail {
            font-size: 12px;
        }

        .image-right-detail a:hover {
            text-decoration: none;
        }

        .image-right img {
            width: 100%;
        }


        .image-right-detail-section2 {
            color: #38ACDF;
            margin: 0px;
        }

        .image-right-detail-section2 span {
            color: #7F7F7F;
        }


    </style>


    <!--*STYLE for pop up model-->
    <style>

        .modal {
            text-align: center;
        }

        @media screen and (min-width: 768px) {
            .modal:before {
                display: inline-block;
                vertical-align: middle;
                content: " ";
                height: 100%;

            }
        }

        .modal-dialog {
            display: inline-block;
            text-align: left;
            vertical-align: middle;

        }

        /* drag and Drop */

        .files input {
            outline: 2px dashed #e83e8c;
            outline-offset: -10px;
            -webkit-transition: outline-offset .15s ease-in-out, background-color .15s linear;
            transition: outline-offset .15s ease-in-out, background-color .15s linear;
            padding: 120px 0px 85px 35%;
            text-align: center !important;
            margin: 0;
            width: 100% !important;
        }

        .files input:focus {
            outline: 2px dashed #e83e8c;
            outline-offset: -10px;
            -webkit-transition: outline-offset .15s ease-in-out, background-color .15s linear;
            transition: outline-offset .15s ease-in-out, background-color .15s linear;
            border: 1px solid #92b0b3;
        }

        .files {
            position: relative
        }

        .files:after {
            pointer-events: none;
            position: absolute;
            top: 60px;
            left: 0;
            width: 50px;
            right: 0;
            height: 56px;
            content: "";
            background-image: url(https://image.flaticon.com/icons/png/128/109/109612.png);
            display: block;
            margin: 0 auto;
            background-size: 100%;
            background-repeat: no-repeat;
        }

        .color input {
            background-color: silver;
        }

        .files:before {
            position: absolute;
            bottom: 10px;
            left: 0;
            pointer-events: none;
            width: 100%;
            right: 0;
            height: 57px;
            content: " or drag and drop it here. ";
            display: block;
            margin: 0 auto;
            color: #e83e8c;
            font-weight: 600;
            text-transform: capitalize;
            text-align: center;
        }

        .changeImageLabel {
            background: rgba(0, 0, 0, 0.5) none repeat scroll 0 0;
            bottom: 150px;
            color: #fff;
            left: 245px;
            margin: 0;
            position: absolute;
            right: 0;
            text-align: center;
            transition: 0.1s all;
            width: 100px;
            display: none;
            font-weight: normal;

        }

    </style>


</head>

<body class="profileContainerDetails">

<!--dialog pop-ups-->
<dialog class="text-center" id="connectedWith"
        style="box-shadow: 2px 2px 2px 2px grey;color: white;position: absolute; top: 30%;z-index: 4;border: 1px solid white;font-family: 'Roboto', sans-serif;border-radius: 8px;background-color: darkgray;width: 400px; height:100px;">
    <div id="newconnectionmodal"></div>
    <br>
    <button id="close" style="border: 1px solid #e83e8c;border-radius: 8px;
        color: #e83e8c; background-color:white; font-family: 'Roboto', sans-serif;position: center; ">Okay
    </button>
</dialog>


<dialog class="text-center" id="forumJoined"
        style="box-shadow: 2px 2px 2px 2px grey;;color: white;position: absolute; top:30%;z-index: 4;border: 1px solid white;font-family: 'Roboto', sans-serif;border-radius: 8px;background-color: darkgray;width: 400px; height:100px;">
    <p>You have joined a new forum!</p>
    <br>
    <button id="shut" style="border: 1px solid #e83e8c;border-radius: 8px;
        color: #e83e8c; background-color:white; font-family: 'Roboto', sans-serif;position: center; ">Okay
    </button>
</dialog>

<!--*BODY* 1. Navigation Bar-->

<nav class="navbar navbar-inverse  ">
    <div class="container-fluid">

        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
        </div>  <!--navbar-header-->

        <div class="collapse navbar-collapse" id="myNavbar"> <!--Navigation bar contents-->

            <!--Left-side (including search ) of navigation bar-->
            <ul class="nav navbar-nav navbar-left">
                <li><a onclick="location.href='{% url 'nav_home' %}'">
                    <span class="glyphicon glyphicon-home fa-lg"></span>
                    Home
                </a></li>
                <li><a onclick="location.href='{% url 'nav_networks' %}'"><span class="fa fa-globe fa-lg"></span>
                    Connections</a></li>
                <li><a onclick="location.href='{% url 'nav_forums' %}'"><span class="fa fa-comments-o fa-lg"></span>
                    Forums</a></li>
                <li><a onclick="location.href='{% url 'nav_courses' %}'"><span class="fa fa-book fa-lg"></span> Courses</a>
                </li>
            </ul>


            <!--RHS of the navigation bar -->

            <ul class="nav navbar-nav navbar-right">

                <!--MESSAGE NOTIFICATIONS -->


                <!--REQUESTS NOTIFICATIONS -->


                <!--Profile Drop-Down -->
                <li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"
                                        onclick="CloseIntroForm(); OpenLogIn();">

                    <span onclick="location.href='{% url 'userprofile' %}'"> <img class="rounded-circle" width="20"
                                                                                  height="20" src="{{ my_profile_pic }}"
                                                                                  alt=""></span>

                    <span class="glyphicon glyphicon-triangle-bottom"></span></a>

                    <ul class="dropdown-menu">
                        <li><a onclick="location.href='{% url 'settings' %}'">Settings <span
                                class="glyphicon glyphicon-cog pull-right"></span></a></li>
                        <li class="divider"></li>
                        <li><a onclick="location.href='{% url 'nav_forums' %}'">Forums <span
                                class="fa fa-comments-o pull-right"></span></a></li>
                        <li class="divider"></li>

                        <li><a onclick="location.href='{% url 'helpUserProfile' %}'">Help<span
                                class="glyphicon glyphicon-question-sign pull-right"></span></a></li>
                        <li class="divider"></li>
                        <li><a onclick="location.href='{% url 'log' %}'">Sign Out <span
                                class="glyphicon glyphicon-log-out pull-right"></span></a></li>
                    </ul>
                </li>


            </ul><!--nav navbar-nav navbar-right-->
        </div><!--collapse nav-bar collapse-->
    </div><!--container fluid-->
</nav><!--nav navbar-inverse-->


<script>

    /*Time for Posts Displayed*/
    const MONTH_NAMES = [
        'January', 'February', 'March', 'April', 'May', 'June',
        'July', 'August', 'September', 'October', 'November', 'December'
    ];

    function getFormattedDate(date, prefomattedDate = false, hideYear = false) {
        const day = date.getDate();
        const month = MONTH_NAMES[date.getMonth()];
        const year = date.getFullYear();
        const hours = date.getHours();
        let minutes = date.getMinutes();

        if (minutes < 10) {
            // Adding leading zero to minutes
            minutes = `0${minutes}`;
        }

        if (prefomattedDate) {
            // Today at 10:20
            // Yesterday at 10:20
            return `${prefomattedDate} at ${hours}:${minutes}`;
        }

        if (hideYear) {
            // 10. January at 10:20
            return `${day}. ${month} at ${hours}:${minutes}`;
        }

        // 10. January 2017. at 10:20
        return `${day}. ${month} ${year}. at ${hours}:${minutes}`;
    }

    // --- Main function
    function timeAgo(dateParam) {

        if (!dateParam) {
            return null;
        }

        const date = typeof dateParam === 'object' ? dateParam : new Date(dateParam);
        const DAY_IN_MS = 86400000; // 24 * 60 * 60 * 1000
        const today = new Date();
        const yesterday = new Date(today - DAY_IN_MS);
        const seconds = Math.round((today - date) / 1000);
        const minutes = Math.round(seconds / 60);
        const isToday = today.toDateString() === date.toDateString();
        const isYesterday = yesterday.toDateString() === date.toDateString();
        const isThisYear = today.getFullYear() === date.getFullYear();


        if (seconds < 5) {
            return 'now';
        } else if (seconds < 60) {
            return `${seconds} seconds ago`;
        } else if (seconds < 90) {
            return 'about a minute ago';
        } else if (minutes < 60) {
            return `${minutes} minutes ago`;
        } else if (isToday) {
            return getFormattedDate(date, 'Today'); // Today at 10:20
        } else if (isYesterday) {
            return getFormattedDate(date, 'Yesterday'); // Yesterday at 10:20
        } else if (isThisYear) {
            return getFormattedDate(date, false, true); // 10. January at 10:20
        }

        return getFormattedDate(date); // 10. January 2017. at 10:20
    };


    /*Message_Notificationas*/

    var Message_Notifications_Check = firebase.database().ref().child("Users/{{this_uid}}/Messages_Notifications");/*current user's account*/
    Message_Notifications_Check.on('value', function (snapshot) {
        msg_messages_dropdown(snapshot.val());
        msg_message_number(snapshot.val());
    });

    function msg_messages_dropdown(obj) {


        var dropdown_item = '';
        var keys = Object.keys(obj);
        var counter_check = 0;


        for (var i = keys.length - 1; i >= 0; i--) {

            if (obj[keys[i]].ProfilePic != undefined) {

                var display_time = obj[keys[i]].Time;
                display_time = Number(display_time); // cast it to a Number
                var ts_display = timeAgo(display_time);


                if (counter_check == 0) {
                    counter_check++;

                    dropdown_item += " <a><div style= \"padding: 2px;\n" +
                        "            margin: 5px;\n" +
                        "            border-radius: 4px;\n" +
                        "            border-width: 5px;\n" +
                        "            border-color: black;\n" +
                        "            height: 80px;\n" +
                        "             margin-left: -20px;\n" +
                        "            margin-top: 20px  \" class=\"notification-item\">\n" +
                        "                                <img style=\"margin-top:-12px\" class=\"profile_img\" src=\"" + obj[keys[i]].ProfilePic + "\"/>\n" +
                        "                                    \n" +
                        "                                    <h5 style=\"font-family: sans-serif; font-weight: bold; color: black; margin-top: -15px; left: 55px; position:relative\">" + obj[keys[i]].Sender_name + "</h5>\n" +
                        "                                    <p style=\"font-family: sans-serif; color: black; margin-top: 3px;left: 28px;position:relative; \"> " + obj[keys[i]].text + "</p>\n" +
                        "                                    <p style=\"font-family:sans-serif;font-style:italic;margin-left: 58px;margin-top:2px; color: grey;font-size:x-small\"><i class= \"fa fa-clock-o \"></i>&nbsp" + ts_display + "</p>\n" +
                        "                                    <hr style=\"width: 100%; color: grey; height: 2px; background-color:grey; margin-top: 5px\"/>\n" +
                        "                                </div>\n" +
                        "                            </a>";

                } else {

                    dropdown_item += " <a><div style= \"padding: 5px;\n" +
                        "            margin: 5px;\n" +
                        "            border-radius: 4px;\n" +
                        "            border-width: 5px;\n" +
                        "            border-color: black;\n" +
                        "            height: 80px;\n" +
                        "             margin-left: -20px;\n" +
                        "            margin-top: 20px \" class=\"notification-item\">\n" +
                        "                                <img style=\"margin-top:-12px\" class=\"profile_img\" src=\"" + obj[keys[i]].ProfilePic + "\"/>\n" +
                        "                                    \n" +
                        "                                    <h5 style=\"font-family: sans-serif; font-weight: bold; color: black; margin-top: -15px; left: 55px; position:relative\">" + obj[keys[i]].Sender_name + "</h5>\n" +
                        "                                    <p style=\"font-family: sans-serif; color: black; margin-top: 3px;left: 28px;position:relative; \">" + obj[keys[i]].text + "</p>\n" +
                        "                                    <p style=\"font-family:sans-serif;font-style:italic;margin-left: 58px;margin-top:2px; color: grey;font-size:x-small\"><i class= \"fa fa-clock-o \"></i>&nbsp" + ts_display + "</p>\n" +
                        "                                    <hr style=\"width: 100%; color: grey; height: 2px; background-color:grey; margin-top: 5px\"/>\n" +
                        "                                </div>\n" +
                        "                            </a>";
                }

            }
        }
        $('#Message_dropdown_notifications').html(dropdown_item);
    }


    function msg_message_number(obj) {
        // var html = '';
        var countholder = 0;
        var keys = Object.keys(obj);

        for (var i = 0; i < keys.length; i++) {
            countholder++;
        }
        {% comment %}
                        countholder--;
        {% endcomment %}

        {% comment %}database_counter.update({'counter': countholder});
         /*Creating notification icon*/{% endcomment %}


        {% comment %}
                        html += "<span class=\"glyphicon glyphicon-bell\"></span>&nbsp;<span class=\"label label-default\" style=\"background-color: red;color: white\">" + countholder + "</span></a>";
        {% endcomment %}


        $('#number_of_msg_notifications').html(countholder);


    }

    function removeMessageNotifications() {

        var other = firebase.database().ref().child("Users/" + '{{ this_uid }}');/*Messages*/
        other.child("Messages_Notifications").remove();

    }


    /*Request Notifications*/

    var database_counter = firebase.database().ref().child("Users/{{this_uid}}/RequestsReceived");/*current user's account*/


    database_counter.on('value', function (snapshot) {
        renderCount(snapshot.val());
        renderUI(snapshot.val());
        //alert("Connection Request Received");


    });


    function renderUI(obj) {
        var html = '';
        var keys = Object.keys(obj);
        for (var i = keys.length - 1; i >= 0; i--) {
            // for (var i = 0; i <= keys.length - 1; i++) {


            /* html += "<li><b><i>" + obj[keys[i]].time + "</i></b> girl " + obj[keys[i]].receiver + "</li>";*/
            /*Creating notification item*/

            if (obj[keys[i]].sender_profilePic != undefined) {

                var display_time = obj[keys[i]].time;
                display_time = Number(display_time); // cast it to a Number
                var ts_display = timeAgo(display_time);

                var type_post = obj[keys[i]].Type;
                var forum_id_id = obj[keys[i]].Forum_ID;


                var decision = "true";
                var opp_decison = "false";
                html += "<div href=\"#\" class=\"content\" style=\"padding:5px;margin: 5px; border-radius: 4px; border-width: 5px; border-color: black; height: 80px; margin-left: -20px; margin-top: 40px;\"> <div style=\"padding:2px;margin:5px;border-radius:4px;border-width:5px;border-color:black;height:80px;margin-left: -10px\"><img  class=\"profile_img_1\" src=\" " + obj[keys[i]].sender_profilePic + "\"/> <p style=\"margin-left: 155px;font-size: 60%; color: darkgray;text-decoration: none\">" + "" + "&nbsp;&nbsp;</p> <h5 style=\"font-family: sans-serif; font-weight: bold; color: black; margin-top: 0px; top: -20px;left: 25px; position:relative\">" + obj[keys[i]].sender + "</h5> <p style=\"font-family: sans-serif; color: black; margin-top: -25px;left: 28px;position:relative; \">" + obj[keys[i]].message +
                    "</p> <p style=\"font-family:sans-serif;font-style:italic;margin-left: 55px;margin-top:5px; color: grey;font-size: x-small\"><i class= \"fa fa-clock-o \"></i> " + ts_display + "</p>  <div style=\"margin-top: 10px\"> <button  id=\"dntrigger\" onclick=\"Accept_request(" + "\'" + obj[keys[i]].sender_id + "\'" + "," + "\'" + obj[keys[i]].sender + "\'" + "," + "\'" + obj[keys[i]].post_id + "\'" + "," + "\'" + decision + "\'" + ",\'" + type_post + "\',\'" + forum_id_id + "\' )\" class=\"AcceptDeclinebutton\" style=\" font-size: 85%; position: relative;left: 80px;color: white\">Accept</button> <button id=\"DeclineRemove\" onclick=\"Accept_request(" + "\'" + obj[keys[i]].sender_id + "\'" + "," + "\'" + obj[keys[i]].sender + "\'" + "," + "\'" + obj[keys[i]].post_id + "\'" + "," + opp_decison + ")\" class=\"AcceptDeclinebutton\" style=\"; font-size: 85%;position: relative;left: 80px;color: white \">Decline </button> </div> <hr style=\"width: 100%; color: gray; height: 2px; background-color:grey; margin-top: 5px\"/> </div> </div><br>";


            }
        }
        $('#comment').html(html);
    }

    function renderCount(obj) {
        var html = '';
        var countholder = 0;

        var keys = Object.keys(obj);
        for (var i = 0; i < keys.length; i++) {
            countholder++;
        }
        countholder--;
        database_counter.update({'counter': countholder});
        /*Creating notification icon*/


        html += "<span class=\"glyphicon glyphicon-bell\"></span>&nbsp;<span class=\"label label-default\" style=\"background-color: red;color: white\">" + countholder + "</span></a>";


        $('#counter_number_notifications').html(html);


    }

    function Accept_request(sender_id, name, post_id, isAccept, typepost, forum_id_id) {


        if (String(isAccept).valueOf() == String("true").valueOf()) {

            /*Check Type of Request*/

            firebase.database().ref("Users/" + '{{this_uid}}' + "/RequestsReceived/" + post_id + "/Type_check").once("value", snapshot => {

                if (snapshot.exists()) {


                    if (String(typepost).valueOf() == String("Forum_Request").valueOf()) {

                        var AddtoForum = firebase.database().ref().child("Forums/" + forum_id_id + "/Participants");/*Messages*/
                        AddtoForum.child(sender_id).set(sender_id);

                        var AddtoForum_Joined = firebase.database().ref().child("Users/" + sender_id + "/ForumsJoined");/*Messages*/
                        AddtoForum_Joined.child(forum_id_id).set(forum_id_id);

                    } else {


                        var AddtoForum = firebase.database().ref().child("Forums/" + sender_id + "/Participants");/*Messages*/

                        AddtoForum.child('{{this_uid}}').set('{{ this_uid }}');


                        var AddtoForum_Joined = firebase.database().ref().child("Users/" + '{{this_uid}}' + "/ForumsJoined");/*Messages*/

                        AddtoForum_Joined.child(sender_id).set(sender_id);


                        // window.alert("You have joined a new forum!");
                        var x = document.getElementById("forumJoined");
                        x.show();
                    }


                }/*Forum Requests*/

                else {


                    var AddConnection = firebase.database().ref().child("Users/" + '{{this_uid}}' + "/Connections");/*Messages*/
                    var AddConnection_other = firebase.database().ref().child("Users/" + sender_id + "/Connections");/*Messages*/


                    //AddConnection.child(sender_id).set(name);
                    var bio;
                    var propic;
                    var country;
                    var html = '';
                    var getAcceptcon = firebase.database().ref().child("Users/" + sender_id);
                    getAcceptcon.on("value", function (snapshot) {
                        bio = snapshot.val().Bio;
                        propic = snapshot.val().ProfilePic;
                        country = snapshot.val().Country;
                    });

                    //var created_id_target = AddConnection.push();
                    AddConnection.child(sender_id).set({ /*Pushes to receiver*/
                        Name: name,
                        Bio: bio,
                        ProfilePic: propic,
                        Country: country,

                    });

                    AddConnection_other.child('{{this_uid}}').set({ /*Pushes to receiver*/
                        Name: '{{ n }}',
                        Bio: '{{ bio }}',
                        ProfilePic: '{{ ProfilePic }}',
                        Country: '{{ my_country }}',

                    });


                    // window.alert("You are now connected with " + name);

                    html += "You are now connected with " + name;
                    $('#newconnectionmodal').html(html);

                    var y = document.getElementById("connectedWith");
                    y.show();

                }/*Friend Reuest*/
            }); /*Checking Type of Request*/
        } /*If Accept*/


        firebase.database().ref("Users/" + '{{this_uid}}' + "/RequestsReceived/" + post_id + "/Type").once("value", snapshot => {

            if (snapshot.exists()) {

                var different_name = firebase.database().ref().child("Users/" + '{{this_uid}}' + "/RequestsReceived/" + post_id);/*Messages*/
                different_name.remove();


            } else {

                var different_name = firebase.database().ref().child("Users/" + '{{this_uid}}' + "/RequestsReceived/" + post_id);/*Messages*/
                different_name.remove();

                var removesent = firebase.database().ref().child("Users/" + post_id + "/RequestsSent/" + '{{this_uid}}');/*Messages*/
                removesent.remove();


            }

        });


    }


</script>

<!--End of Navigation Bar-->

<!--User Profile Container-->
<!--Background Image-->
<div class="UserWallpaper parallax" style="background-image:url(
        {% load staticfiles %}{% static "GC_Auth/UserProfile_images/campus.jpg" %}); margin-top: -20px;"></div>
<div class="profileContainer profileContainerLift"><!--1. Container for the whole user profile -->

    <div class="row"> <!--2. Pic + Description -->
        <div class="col-md-6 ml-auto mr-auto">
            <div class="profile">
                <div class="avatar">
                    <img style="margin-left: 200px" src="{{ ProfilePic }}" alt="Circle Image"
                         class="img-raised rounded-circle img-fluid">


                </div>


                <div class="name" style="margin-left: 58%; margin-top: -21%;background-color: white ; width: 85%">
                    <div class="row" style="">
                        <div class="col-md-8 col-sm-6 col-xs-6 profile-header-section1 pull-left">
                            <div style="text-align: left;">
                                <h1 style="color: gray;display: inline-block;padding-right:50px;">
                                    <strong>{{ n }}</strong><br></h1><br><br> <!--Name of User-->

                                <div class="settings ">
                                    <!--Settings Bar-->

                                    <button data-placement="right"
                                            style="background-color:white; border-color: #e83e8c; margin-right: -31%; margin-top: -48px; border-radius: 10px; box-shadow: 0 0 3px rgba(0, 0, 0, 0.1) inset "
                                            class="btn btn-primary pull-right">
                                        <a data-toggle="modal" data-target="#viewmutualsmodal" style="color: darkgray;">Mutual
                                            Connections</a>
                                    </button>

                                </div>
                                <script>
                                    $(document).ready(function () {
                                        $('[data-toggle="tooltip"]').tooltip();
                                    });


                                </script>

                                <script>
                                    //  count the number of forums and connections in db
                                    var numForumsRef = firebase.database().ref("Users").child("{{ this_uid }}").child("ForumsJoined");
                                    numForumsRef.on("value", function (numForums_snapshot) {
                                        document.getElementById("numForumsSpan").innerText = numForums_snapshot.numChildren();
                                        var numConnRef = firebase.database().ref("Users").child("{{ this_uid }}").child("Connections");
                                        numConnRef.on("value", function (numConnections_snapshot) {
                                            document.getElementById("numConnectionsSpan").innerText = numConnections_snapshot.numChildren();
                                        });
                                    });
                                </script>

                                <!--Number of Connections and Forums-->
                                <h8 style="display: inline-block;padding-right:10px; position: relative; top: -14px; ">
                                    Connections <span id="numConnectionsSpan" class="label label-default"></span></h8>
                                <h8 style="display: inline-block;padding-right:50px; position: relative; top: -14px">
                                    Forums <span id="numForumsSpan"
                                                 class="label label-default"></span></h8>

                            </div>
                            <!--Container for bio, email, country-->
                            <div style="margin-top:-5px">

                                <span style="color: black;position: relative;"
                                      class="glyphicon glyphicon-bookmark"></span>&nbsp;&nbsp;<strong><span
                                    style="font-size: small;color: grey">{{ bio }} </span></strong><br>

                                <span style="color: black;position: relative;"
                                      class="fa fa-globe fa-lg text-primary"></span>&nbsp;&nbsp;<strong><span
                                    style="font-size: small;color: grey">{{ country }} </span></strong><br>

                            </div>
                            <!--Connect and message buttons-->


                            <!--Badges Icon-->
                            {% if enabled == 'True' or enabled == 'true' or enabled == True or enabled == true %}
                                <!-- allow the user to disable only when the account is enabled-->

                                <a data-toggle="modal" data-target="#BadgeModal">

                                    <img src="{% static "GC_Auth/UserProfile_images/badge_icon.png" %}"
                                         data-toggle="tooltip" title="Badges" data-placement="right"
                                         style="width:40px;height:40px; position: absolute; top:80px; left: 459px; box-shadow: 0 0 3px rgba(0, 0, 0, 0.1) inset; background-color:white;border-radius: 10px;  "
                                         title="" class="badges  "/>
                                </a>
                                <hr style="width: 210%; color: #e83e8c; height: 2px; background-color:gray; margin-top: 10px; margin-left: -250px"/>
                            {% else %}
                                <a hidden disabled="true" onclick="location.href='{% url 'goBadges' %}' ">

                                    <img src="{% static "GC_Auth/UserProfile_images/badge_icon.png" %}"
                                         data-toggle="tooltip" title="Badges" data-placement="right"
                                         style="width:40px;height:40px; position: absolute; top:80px; left: 459px; box-shadow: 0 0 3px rgba(0, 0, 0, 0.1) inset; background-color:white;border-radius: 10px;  "
                                         title="" class="badges  "/>
                                </a>
                                <hr style="width: 210%; color: #e83e8c; height: 2px; background-color:gray; margin-top: 10px; margin-left: -250px"/>
                            {% endif %}


                        </div><!--profile-header-page1-->
                    </div><!--row-->
                </div><!--name-->
            </div><!--profile-->
        </div><!--col-md-6-->
    </div><!--row-->

    <!--Righhand side and middle of page-->
    <div class="description text-left">

        <!--2.RIGHT-HAND SIDE-->
        <div class="col-md-4 rightColumn">

            <div><p class="rightColumnfont"><span
                    class="fa fa-globe"></span>&nbsp;People you may want to
                connect with</p></div>
            <br>
            <div style="height:5px;"><br></div>
            <a onclick="location.href='{% url 'nav_networks' %}'"
               style="font-size: smaller;position: relative;top: 225px; left: 200px; color: gray; font-weight: bold;">
                View More <i class="fa fa-angle-double-right"></i> <!--View More Forums-->
            </a>

            <script>
                function firebase_check_sent(connecion_id) {
                    var firebase_check = firebase.database().ref().child("Users/" + '{{ this_uid }}' + "/RequestsSent");
                    return ("true")
                }
            </script>

            <div class="col-md-12" style="margin-top: -30px;">

                {% for names, countries, pictures, bio, conn_id in connections_suggestions_list|slice:":3" %}
                    <div id="{{ conn_id }}_background" class=" rightColumnContainer" style="margin-top: -10px">
                        <!--Connections Suggestions Card-->
                        <form action="/goConnectionsOpen/" method="post">
                            <button class="badges_plus" type="button" id="btnGetMessage"
                                    onclick=" send_friend_request('{{ conn_id }}')" value="Get Message"
                                    style="position: relative; left: 240px; top: 3px;  "><i id="{{ conn_id }}"
                                                                                            style="color: grey"
                                                                                            class="fa fa-user-plus"></i>
                            </button>

                            <div class="row" style="margin-top: -15px">
                                <img id="{{ conn_id }}_img" class=" pull-left"
                                     style="border-radius: 10px; margin-left: 20px; position:relative; width: 60px; height: 60px"
                                     src="{{ pictures }}"/>

                                <div class="connection_container">
                                    <div>
                                        <input class="connection_id" id="connection_id" name="connection_id"
                                               value="{{ conn_id }}" hidden style="display: none;">
                                        <button id="{{ conn_id }}_name"
                                                style=" background-color: #FCFCFC;font-family: 'Arial Narrow';border:none;left: 5px; font-weight: bold; font-size: small; top: 5px; position: relative"
                                                onclick="location.href='{% url 'connectionsopen' %}'" type="submit"
                                                value="goConnectionsOpen">
                                            {{ names }}
                                        </button>
                                    </div>
                                    <!-- hidden field that stores the id of the entity  -->
                                    <div id="{{ conn_id }}" style="display: none;"> {{ conn_id }}</div>
                                    <h8 style="display: inline-block;margin-left: 5px;margin-top: -10px;font-family:'Arial Narrow'; color:#666666 ;font-weight:bold; font-size: small;">
                                        &nbsp;<span>  {{ countries }} </span>
                                    </h8>
                                    <br>

                                    <span class="badge badge-pill badge-dark"
                                          style=" position:relative;color: white; font-size: x-small; margin-left: 10px; top: -3px">{{ bio }}</span>
                                </div>

                            </div>
                        </form>
                    </div><!--end of Connections Suggestions Card--><br style="height: 2px">
                {% empty %}
                    <div>No Suggested Connections</div>
                {% endfor %}

            </div><!--col-md-12-->


        </div><!--col-md-4 rightColumn-->

        <!--Messaging Implementation-->

        <script>

            const MONTH_NAMES = [
                'January', 'February', 'March', 'April', 'May', 'June',
                'July', 'August', 'September', 'October', 'November', 'December'
            ];

            function getFormattedDate(date, prefomattedDate = false, hideYear = false) {
                const day = date.getDate();
                const month = MONTH_NAMES[date.getMonth()];
                const year = date.getFullYear();
                const hours = date.getHours();
                let minutes = date.getMinutes();

                if (minutes < 10) {
                    // Adding leading zero to minutes
                    minutes = `0${minutes}`;
                }

                if (prefomattedDate) {
                    // Today at 10:20
                    // Yesterday at 10:20
                    return `${prefomattedDate} at ${hours}:${minutes}`;
                }

                if (hideYear) {
                    // 10. January at 10:20
                    return `${day}. ${month} at ${hours}:${minutes}`;
                }

                // 10. January 2017. at 10:20
                return `${day}. ${month} ${year}. at ${hours}:${minutes}`;
            }


            // --- Main function
            function timeAgo(dateParam) {

                if (!dateParam) {
                    return null;
                }

                const date = typeof dateParam === 'object' ? dateParam : new Date(dateParam);
                const DAY_IN_MS = 86400000; // 24 * 60 * 60 * 1000
                const today = new Date();
                const yesterday = new Date(today - DAY_IN_MS);
                const seconds = Math.round((today - date) / 1000);
                const minutes = Math.round(seconds / 60);
                const isToday = today.toDateString() === date.toDateString();
                const isYesterday = yesterday.toDateString() === date.toDateString();
                const isThisYear = today.getFullYear() === date.getFullYear();


                if (seconds < 5) {
                    return 'now';
                } else if (seconds < 60) {
                    return `${seconds} seconds ago`;
                } else if (seconds < 90) {
                    return 'about a minute ago';
                } else if (minutes < 60) {
                    return `${minutes} minutes ago`;
                } else if (isToday) {
                    return getFormattedDate(date, 'Today'); // Today at 10:20
                } else if (isYesterday) {
                    return getFormattedDate(date, 'Yesterday'); // Yesterday at 10:20
                } else if (isThisYear) {
                    return getFormattedDate(date, false, true); // 10. January at 10:20
                }

                return getFormattedDate(date); // 10. January 2017. at 10:20
            };

        </script>

        <script>

            var user = firebase.auth().currentUser;
            /*Firebase Reference*/

            var database_counter = firebase.database().ref().child("Users/{{this_uid}}/RequestsReceived");/*current user's account*/

            /*User Clicks on GetMessages time Firebase button
            * Will need to do one for hourglass to plus sign for the opposite action, or unconnecting*/
            function send_friend_request(request_receiver_id) {

                document.getElementById(request_receiver_id).className = "fa fa-hourglass";

                //$(this).find("i").removeClass("fa fa-user-plus").addClass("fa fa-hourglass");
                // document.getElementById('play').classList.add('fa fa-hourglass');
                /*Fetching time when items were pushed*/

                var d = new Date(),
                    minutes = d.getMinutes().toString().length == 1 ? '0' + d.getMinutes() : d.getMinutes(),
                    hours = d.getHours().toString().length == 1 ? '0' + d.getHours() : d.getHours(),
                    ampm = d.getHours() >= 12 ? 'pm' : 'am',
                    months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                    days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
                /*dateTime = days[d.getDay()] + ' ' + months[d.getMonth()] + ' ' + d.getDate() + ' ' + d.getFullYear() + ' ' + hours + ':' + minutes + ampm;*/
                dateTime = hours + ':' + minutes + ampm;
                /*Changing items in the db*/

                var date_for_post = Date.now();

                writeUserData(date_for_post, "{{ n }}", '{{this_uid}}', "Connection Request", request_receiver_id);
                dateTime;
                "Connection Request";
                "{{ n }}";
                '{{ this_uid }}';
                request_receiver_id;
            }

            /*Push time entered and Message entered from textboxes, creates entry in firebase
            * push gives a unique key*/

            function writeUserData(message_time, messageFrom, request_sender_id, actual_message, request_receiver_id) {/*Pushes to current users*/
                var database = firebase.database().ref().child("Users/" + request_sender_id + "/RequestsSent");/*Current users account*/

                var created_id = database.push();
                created_id.set({
                    time: message_time,
                    sender: messageFrom,
                    sender_id: request_sender_id,
                    message: actual_message,
                    receiver_id: request_receiver_id,
                    sender_profilePic: '{{ ProfilePic }}'
                });

                /*Saving_id*/
                var hope = String(created_id);
                var result = hope.substring(hope.lastIndexOf("/") + 1);
                var save_id = firebase.database().ref().child("Users/" + request_sender_id + "/RequestsSent/" + result);/*Messages*/
                save_id.update({
                    post_id: result
                });

                var database_target = firebase.database().ref().child("Users/" + request_receiver_id + "/RequestsReceived");/*Where the message is going*/
                var created_id_target = database_target.push();
                created_id_target.set({ /*Pushes to receiver*/
                    time: message_time,
                    sender: messageFrom,
                    sender_id: request_sender_id,
                    message: actual_message,
                    receiver_id: request_receiver_id,
                    sender_profilePic: '{{ ProfilePic }}',
                    Type: "Friend_Request",
                    Forum_ID: "noForum_ID"

                });
                hope = String(created_id_target);
                result = hope.substring(hope.lastIndexOf("/") + 1);
                save_id = firebase.database().ref().child("Users/" + request_receiver_id + "/RequestsReceived/" + result);/*Messages*/
                save_id.update({
                    post_id: result
                });

            }

            /*Whenever items changes (added, modified, deleted) in database, this event is called*/

            /* database.on('value', function (snapshot) {
                 renderUI(snapshot.val());

             });*/

            /*Whenever items changes (added, modified, deleted) in database, this event is called*/

            database_counter.on('value', function (snapshot) {
                renderCount(snapshot.val());
                renderUI(snapshot.val());
                //alert("Connection Request Received");
            });

            /* database_count.on('value', function (snapshot) {
                 renderCount(snapshot.val());
             });*/

            /*Always refreshing data being loaded*/

            function renderUI(obj) {
                var html = '';
                var keys = Object.keys(obj);
                for (var i = keys.length - 2; i >= 0; i--) {
                    /* html += "<li><b><i>" + obj[keys[i]].time + "</i></b> girl " + obj[keys[i]].receiver + "</li>";*/
                    /*Creating notification item*/

                    var display_time = obj[keys[i]].time;
                    display_time = Number(display_time); // cast it to a Number
                    var ts_display = timeAgo(display_time);


                    var decision = "true";
                    var opp_decison = "false";
                    html += "<div href=\"#\" class=\"content\" style=\"top: -10px; position:relative;text-decoration: none\"> <div style=\"text-decoration: none\" class=\"notification-item\"><img  class=\"profile_img\" src=\" " + obj[keys[i]].sender_profilePic + "\"/> <p style=\"margin-left: 155px;font-size: 60%; color: darkgray;text-decoration: none\">" + ts_display + "&nbsp;&nbsp;<i style=\"color: black;\"onclick=\"Accept_request(" + "\'" + obj[keys[i]].sender_id + "\'" + "," + "\'" + obj[keys[i]].sender + "\'" + "," + "\'" + obj[keys[i]].post_id + "\'" + "," + opp_decison + ")\" class=\"fa fa-close\"></i></p> <h5 style=\"color: black; margin-top: -15px; left: 25px; position:relative\">" + obj[keys[i]].sender + "</h5> <p style=\"color: black; margin-top: -10px;left: 25px;position:relative; font-size:small\">" + obj[keys[i]].message +
                        "</p> <div style=\"margin-top: -10px\"> <button  id=\"dntrigger\" onclick=\"Accept_request(" + "\'" + obj[keys[i]].sender_id + "\'" + "," + "\'" + obj[keys[i]].sender + "\'" + "," + "\'" + obj[keys[i]].post_id + "\'" + "," + decision + " )\" class=\"AcceptDeclinebutton\" style=\" font-size: 85%; position: relative;left: 80px;color: white\">Accept</button> <button id=\"DeclineRemove\" onclick=\"Accept_request(" + "\'" + obj[keys[i]].sender_id + "\'" + "," + "\'" + obj[keys[i]].sender + "\'" + "," + "\'" + obj[keys[i]].post_id + "\'" + "," + opp_decison + ")\" class=\"AcceptDeclinebutton\" style=\"; font-size: 85%;position: relative;left: 80px;color: white \">Decline </button> </div> <hr style=\"width: 100%; color: gray; height: 2px; background-color:grey; margin-top: 5px\"/> </div> </div>";
                }
                $('#comment').html(html);
            }

            /*Updating notification count*/

            function renderCount(obj) {
                var html = '';
                var countholder = 0;

                var keys = Object.keys(obj);
                for (var i = 0; i < keys.length; i++) {
                    countholder++;
                }
                countholder--;
                database_counter.update({'counter': countholder});
                /*Creating notification icon*/


                html += "<span class=\"glyphicon glyphicon-bell\"></span>&nbsp;<span class=\"label label-default\" style=\"background-color: red;color: white\">" + countholder + "</span></a>";


                $('#counter_number_notifications').html(html);

            }


            /*NOTIFICATION ON ADD (to be places here): Specific to Add: Whenever items changes (added because of child_added) in database, this event is called, getKey is unique id of pop up*/
            function Delete_request(post_id) {


                var different_name = firebase.database().ref().child("Users/" + '{{this_uid}}' + "/RequestsReceived/" + post_id);/*Messages*/

                different_name.remove();
                //window.alert( typeof post_id );
            }

            function Accept_request(sender_id, name, post_id, isAccept) {


                if (String(isAccept).valueOf() == String("true").valueOf()) {
                    var AddConnection = firebase.database().ref().child("Users/" + '{{this_uid}}' + "/Connections");/*Messages*/

                    AddConnection.child(sender_id).set(name);

                    window.alert("You are now connected with " + name);
                }
                var different_name = firebase.database().ref().child("Users/" + '{{this_uid}}' + "/RequestsReceived/" + post_id);/*Messages*/

                different_name.remove();
                //window.alert( typeof post_id );
            }


        </script>


        <div class="col-md-4 rightColumnTwo">

            <div><p class="rightColumnfont"><span
                    class="fa fa-comments-o"></span>&nbsp;Forums you may want to join</p></div>

            <a onclick="location.href='{% url 'nav_forums' %}'"
               style="font-size: smaller;position: relative;top: 175px; left: 200px; color: gray; font-weight: bold;"
            >
                View More <i class="fa fa-angle-double-right"></i> <!--View More Forums-->
            </a>


            <div class="col-md-12" style="margin-top: -3px">


                {% for forum_names, forum_pics, forum_num_participants, forum_creators, forum_topics, forum_descriptions, forum_ids in forums_suggestions_list|slice:":3" %}
                    <div id="{{ forum_ids }}_hideForumSuggestion" class=" rightColumnContainer"
                         style="margin-top: -10px"><!--Forum Suggestions Card-->
                        <input type="hidden" class="forum_id" id="forum_id" value="{{ forum_ids }}" hidden
                               style="color: white;">

                        <div style="position: relative; left: 235px; top: 3px;">
                            <h8><span class="label label-default"><span
                                    class="fa fa-users"> </span>{{ forum_num_participants }}</span></h8>
                        </div>

                        <div class="row" style="margin-top: -15px">
                            <img class=" pull-left"
                                 style="border-radius: 10px; margin-left: 20px; position:relative; width: 60px; height: 60px"
                                 src="{{ forum_pics }}"/>

                            <div class="connection_container">
                                <div>
                                    <button onclick="joinForum('{{ forum_ids }}', '{{ this_uid }}', '{{ forum_names }}','{{ forum_ids }}_hideForumSuggestion')"
                                            style=" border: none; font-family: 'Arial Narrow';background: #FCFCFC;left: 5px;font-size: small; font-weight: bold; color: gray; font-weight: bold; position: relative; top: 5px"
                                            type="submit">{{ forum_names }}
                                    </button>
                                </div>
                                <div id="forum_id" style="display: none;"> {{ forum_ids }}</div>

                                <h8 style="display: inline-block;margin-left: 10px;font-family: serif;margin-top: 4px; font-size: small; color: black">
                                    Creator: {{ forum_creators }}</h8>
                                <br>

                                <span class="badge badge-pill badge-dark"
                                      style="color: white; font-size: x-small; margin-left: 10px; top: 10px">{{ forum_topics }} </span>

                            </div>

                        </div>
                    </div><!--end of Forum Suggestions Card--><br>
                {% empty %}
                    <div>No Forum Suggestions</div>
                {% endfor %}

            </div><!--col-md-12-->

        </div><!--col-md-4 rightColumnTwo-->

        <!-- My Forums -->

        <div class="row"
             style=" height: 250px ; margin-left:-259px; width: 850px; position: relative; top: -420px; overflow: hidden">
            <div style="height:10px;"><br></div>

            <h5 class="titlefont" style="font-weight: bold; margin-left: 4px"><span
                    class="fa fa-comments-o fa-lg"></span>&nbsp;Forums</h5>
            <div style="height:10px;"><br></div>

            <!-- My Forums: Item  -->



            {% for forum_names,forum_pics,forum_num_participants, forum_creators, forum_topics, forum_descriptions, forum_ids in forums_list|slice:":3" %}
                <form action="/goForumsOpen/" method="post">
                    {% csrf_token %}
                    <div class="col-sm-3  " style="; width: 180px; margin-left:30px;  ">
                        <!-- forum wallpaper -->
                        <div class="cardheader"
                             style="background-image: url({% load staticfiles %}{{ forum_pics }}); border-radius: 8px">
                        </div>
                        <!-- Go into forum -->
                        <div class="heartbutton"><span style="background: transparent; " type="button"
                                                       class="viewForum"></span></div>
                        <!-- card with forum detains -->
                        <div class="card hovercard " style="margin-top: -50px; margin-left: 11px">

                            <div>
                                <!-- Number fo forum users -->
                                <div style="top: 2px; margin-left: 70%">
                                    <h8><span class="label label-default"><span
                                            class="fa fa-users"> </span>{{ forum_num_participants }}</span></h8>
                                    <div style="height:5px;"><br></div>
                                </div>

                                <div style="font-family: 'Arial Narrow'; font-weight: bold; font-size: 13px ">{{ forum_names }}
                                </div>
                                <div id="forum_id" style="display: none;"> {{ forum_ids }}</div>
                                <!-- forum tags -->
                                <span class="badge badge-pill badge-dark"
                                      style="font-size: 11px">{{ forum_topics }}</span>


                            </div>
                            <!-- card line -->

                            <hr style="width: 80%; color: #e83e8c; height: 2px; background-color:#e83e8c; margin-top: 5px"/>

                            <input type="hidden" class="forum_id" id="forum_id" name="forum_id" value="{{ forum_ids }}"
                                   hidden style="color: white;">
                            <!-- Open forum button -->

                        </div><!-- /card-hovercard -->
                    </div>
                </form>
            {% empty %}
                <div>{{ n }} has no forums</div>
            {% endfor %}

        </div><!-- /First View Button fot main body, container-->

        <script>

            function joinForum(forum_id, thisUserid, forum_name, hide_block) {
                var db = firebase.database().ref('Forums');
                this_uid = '{{ my_uid }}';

                blockedUsersRef = db.child(forum_id).child("Blocked");                                                  // get list of users blocked for this forum
                blockedUsersRef.once('value', function (snapshot) {
                    blockedUsers = snapshotToArrayKey(snapshot);

                    if (this.arrayContainsValue(blockedUsers, this_uid) == false) {                                      // if this user is NOT blocked for the forum selected
                        forumPrivateRef = db.child(forum_id).child('Private');                                          // get the privacy settings of the forum
                        forumPrivateRef.once('value', function (snapPrivate) {
                            privacy = snapPrivate.val();
                            if (privacy == false) {                                                                      // if the forums is not private
                                json_dict = {};
                                json_dict[forum_id] = forum_id;

                                updateUserForumsRef = firebase.database().ref().child("Users").child(this_uid).child("ForumsJoined");
                                updateUserForumsRef.update(json_dict);                                                  // add the forum to the ForumsJoined for the userf

                                json_dict[this_uid] = this_uid;
                                updateForumParticipantsRef = firebase.database().ref().child("Forums").child(forum_id).child("Participants");
                                updateForumParticipantsRef.update(json_dict);                                           // add the user to the list of forum participants

                                this.hideDiv(hide_block);

                                getNumParticipantsRef = firebase.database().ref("Forums").child(forum_id).child("NumParticipants");         // reduce nunm participants in this forum
                                getNumParticipantsRef.once('value', function (snapshot) {
                                    var numParticipants = snapshot.val();                                               // get the current number of participants

                                    json_dict = {NumParticipants: numParticipants + 1};                                   // reduce num participants by 1

                                    reduceNumParticipantsRef = firebase.database().ref("Forums").child(forum_id);
                                    reduceNumParticipantsRef.update(json_dict);                                         // update database

                                    $("#modalForumJoined").modal('show');
                                });


                            } else {                                                                                       // if the forum is private
                                forumCreatorRef = db.child(forum_id).child('Creator');
                                forumCreatorRef.once('value', function (snapCreator) {
                                    creator_id = snapCreator.val();                                                     // send the message to this user id
                                    message = '{{ username }}' + " has requested to join your forum, " + forum_name + ".";
                                    // code for the resolve/accept button is the code in the if(privacy == "false") if statement above. i.e. the if statement that is above this else statement
                                    /*Sending Forum Request to Creator*/
                                    var other = firebase.database().ref().child("Users/" + creator_id + "/RequestsReceived");/*Messages*/
                                    var date_for_post = Date.now();

                                    var created_id_1 = other.push();
                                    created_id_1.set({

                                        time: date_for_post,
                                        sender: '{{ n }}',
                                        sender_id: '{{ this_uid }}',
                                        message: message,
                                        receiver_id: creator_id,
                                        sender_profilePic: '{{ ProfilePic }}',
                                        Type: "Forum_Request",

                                    });

                                    var hope = String(created_id_1);
                                    var result = hope.substring(hope.lastIndexOf("/") + 1);
                                    var save_id = firebase.database().ref().child("Users/" + creator_id + "/RequestsReceived/" + result);/*Messages*/
                                    save_id.update({
                                        post_id: result
                                    });

                                    /*End of Sending Forum Request to Creator*/

                                    $("#modalJoinRequestSent").modal('show');                                           // popup notifies user of join request being sent
                                })

                            }
                        })

                    } else {                                                                                               // if the user is blocked, display a message to the user
                        $("#modalBlockedFromForum").modal('show');
                    }


                });

            }

            // hides the div with the specified id
            function hideDiv(div_name) {
                document.getElementById(div_name).hidden = true;     // remove forum from all forums

            }

            // get a snapshot of a list of keys from firebase and convert it to an array
            function snapshotToArray(snapshot) {
                let returnArr = [];

                snapshot.forEach(childSnapshot => {
                    let item = childSnapshot.val();
                    item.key = childSnapshot.key;
                    returnArr.push(item);
                });

                return returnArr;
            }

            // returns true if the array contains the value
            function arrayContainsValue(array, value) {
                if (array.length > 0) {
                    for (let i = 0; i < array.length; i++) {
                        if (array[i] == value) {
                            return true;
                        }
                    }
                    return false;
                } else {
                    return false;
                }
            }

            // get a snapshot of a list of keys from firebase and convert it to an array
            function snapshotToArrayKey(snapshot) {
                let returnArr = [];

                snapshot.forEach(childSnapshot => {
                    //let item = childSnapshot.val();
                    var key = childSnapshot.key;
                    returnArr.push(key);
                });

                return returnArr;
            }

        </script>
        <!-- My Courses: Item 1 -->

        <div class="row"
             style=" height: 250px ; margin-left:-250px; width: 850px; position: relative; top: -390px; overflow: hidden">

            <h5 class="titlefont" style="font-weight: bold; margin-left: -5px"><span class="fa fa-book fa-lg"></span>&nbsp
                Favourite Courses</h5>
            <div style="height:10px;"><br></div>

            {% for course_names,course_pictures,course_recommendations, course_urls, course_uni_pics, courses_ids, course_topics, course_uni, course_hearted in course_list|slice:":2" %}
                {% load staticfiles %}
                <div class="col-sm-3  "
                     style=" width: 202px; margin-top: 25px; margin-left: 15px; display:{{ course_display_1 }}  ">


                    <div class=" rightColumnContainer_lower" style="width: 175px; height: 90px; ">

                        <div style="margin-top: -15px; text-align: center;border-radius: 8px ">

                            <div style="height:2px;"><br></div>

                            <div style="font-family: 'Arial Narrow'; text-align: center; font-weight: bold; font-size: small; top: 5px; position: relative">
                                {{ course_names }}
                            </div>
                            <!-- hidden field that stores the id of the entity  -->
                            <div id="course_id" style="display: none;"> {{ courses_ids }}</div>

                            <div style="height:2px;"><br></div>

                            <span class="badge badge-pill badge-dark"
                                  style="color: white; font-size: x-small;  top: 10px">{{ course_recommendations }}</span><br>
                            <div style="height:5px;"><br></div>

                            {% if course_names == "Course is Private" %}
                                <div style="font-size: smaller; margin-left: 0px;color: black; font-weight: bold; "
                                >VIEW
                                    COURSE <i class="fa fa-angle-double-right"></i></div>
                            {% else %}
                                <a style="font-size: smaller; margin-left: 0px;color: black; font-weight: bold; "
                                   href={{ course_urls }}>VIEW
                                    COURSE <i class="fa fa-angle-double-right"></i></a>
                            {% endif %}
                        </div>

                    </div>


                </div>
            {% empty %}
                <div>{{ n }} has no courses</div>
            {% endfor %}


        </div>


    </div>

    <!-- Page Footer-->
    <footer class="page-footer font-small cyan darken-3"
            style="background-color: #D3D3D3; position: relative; top: -420px;">


        <div class="container">
            <br></br>
            <!-- Call to action -->
            <ul class="list-unstyled list-inline text-center py-2">
                <li class="list-inline-item">
                    <!--  <h5 class="mb-1">Log in now: </h5>-->
                </li>
                <li class="list-inline-item">


                    <div class="rowthis"><!--table row-->

                        <div class="col-sm-3" style="text-align:left;padding-right: 100px;">
                            <br>
                            {% load staticfiles %}
                            <img src="{% static "GC_Auth/logotrans.png" %}" alt="lock" class="image">
                        </div>


                        <div class="col-sm-3" style="text-align:left;padding-left: 120px;">

                            <p style="color:#e83e8c;font-size:20px;"><strong>Menu</strong></p>
                            <a onclick="location.href='{% url 'nav_home' %}'" style="color: white"><p>Home</p></a>
                            <a onclick="location.href='{% url 'nav_networks' %}'" style="color: white"><p>
                                Connections</p>
                            </a>
                            <a onclick="location.href='{% url 'nav_forums' %}'" style="color: white"><p>Forums</p></a>
                            <a onclick="location.href='{% url 'nav_courses' %}'" style="color: white"><p>Courses</p></a>
                        </div>

                        <div class="col-sm-3" style="text-align:left;padding-left: 80px;"><!--coloumn-->

                            <p style="color:#e83e8c;font-size:20px;"><strong>Help & FAQs</strong></p>

                            <a onclick="location.href='{% url 'introHelp' %}'" style="color: white"><p>What is
                                GetConnected?</p></a>
                            <a onclick="location.href='{% url 'accountHelp' %}'" style="color: white"><p>Your
                                Account</p>
                            </a>
                            <a onclick="location.href='{% url 'forumsHelp' %}'" style="color: white"><p>Forums &
                                Messaging</p></a>
                            <a onclick="location.href='{% url 'helpconnections' %}'" style="color: white"><p>Connection
                                Management</p></a>
                            <a onclick="location.href='{% url 'helpcourses' %}'" style="color: white"><p>Courses
                                Help</p></a>
                            <a href="https://www.getsmarter.com/what-we-do" style="color: white"><p>GetSmarter</p></a>


                        </div>

                        <div class="col-sm-3" style="text-align:left;padding-left: 80px;"><!--coloumn-->

                            <p style="color:#e83e8c;font-size:20px;"><strong>Contact Us</strong></p>
                            <p style="color:white;"><strong>Tel: </strong> 456 4637</p>
                            <p style="color:white;"><strong>Email: </strong> getConnected@GetSmarter.co.za</p>
                            <p style="color:white;"><strong>Working Hours:</strong> Mon - Fri, 09:00 - 17:00</p>


                        </div>


                    </div>

                    <br>
                    <br>


                </li>
            </ul>
            <!-- Call to action -->

        </div>

    </footer>

</div>


<!-- Badge Modal-->
<div class="modal fade" id="BadgeModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle"
     aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <img src="{% static "GC_Auth/badge_icon.png" %}" alt="trohy" class="center"
                     style="width: 10%;height:10%;position: relative; left: 45%;">
                <h5 class="modal-title text-center" id="exampleModalLongTitle"
                    style="color: darkgray; font-size: 20px;">{{ n }}'s Badges</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>

            <div class="modal-body">

                <div class="row" style="  width: 850px; position: relative; margin-left:15px;">
                    <!--Badge 1: FriendFinder-->
                    <div class="col-sm-3" style="background-color:white;">
                        {% load staticfiles %}
                        <!--friend finder 1 connection-->
                        <div id="FriendFinder" class="badgehover"> <!--badge hover for the hovering over the badge-->

                        </div>
                    </div>

                    <!--Badge 2: NetworkingNinja-->
                    <div class="col-sm-3" style="background-color:white;">
                        {% load staticfiles %}
                        <!--coloumn networking ninja-->
                        <div id="NetworkingNinja" class="badgehover">


                        </div>
                    </div>

                    <!--Badge 3: Crazy Connector-->
                    <div class="col-sm-3" style="background-color:white;">
                        <div id="CrazyConnector" class="badgehover">
                            <!--coloumn crazy connector-->

                        </div>
                    </div>

                    <!--Badge 4: Popular Profiler-->
                    <div class="col-sm-3" style="background-color:white;">
                        <div id="PopularProfile" class="badgehover">
                            <!--coloumn popular profiler-->


                        </div>
                    </div>

                </div><!--end row-->
                <div class="row" style="width: 850px; position: relative; margin-left:15px;">

                    <!--Badge 5: Bright Spark-->
                    <div class="col-sm-3" style="background-color:white;"><!-- 3 courses taken-->
                        <div id="BrightSpark" class="badgehover">
                            <!--coloumn popular profiler-->
                        </div>
                    </div>

                    <!--Badge 6: Bright Spark-->
                    <div class="col-sm-3" style="background-color:white;">
                        <!--fab academic 5 courses-->
                        <div id="FabAcademic" class="badgehover">

                        </div>
                    </div>

                    <!--Badge 7: Got_Smarter-->
                    <div class="col-sm-3" style="background-color:white;">
                        <!--got smarter 10 courses-->
                        <div id="Got_Smarter" class="badgehover">
                            <!--coloumn popular profiler-->
                        </div>
                    </div>

                    <!--Badge 8: Locked-->
                    <div class="col-sm-3" style="background-color:white;">
                        <div id="locked" class="badgehover">
                            {% load staticfiles %}

                        </div>
                    </div>

                </div><!--end row-->
                <div class="row" style="width: 850px; position: relative; margin-left:15px;">

                    <!--Badge 9: ForumBoffin-->
                    <div class="col-sm-3" style="background-color:white;">
                        <!--forum boffin , 1 forum-->
                        <div id="ForumBoffin" class="badgehover">
                            <!--coloumn 5 forums-->

                        </div>
                    </div>

                    <!--Badge 10: SuperSecurity-->
                    <div class="col-sm-3" style="background-color:white;"><!--Privacy-->
                        <div class="badgehover">
                            <!--coloumn super security-->
                            {% if privacyUp == "yes" %}
                                <img src="{% static "GC_Auth/Badges/supersecurity1.png" %}" alt="lock" class="image"
                                     style="width:150%;height:150%;margin-left: 17px;">
                                <div class="middle">
                                    <div class="text"><strong>Super Security</strong> <br> Updated you Privacy Settings
                                    </div>
                                    <!--text for the hover-->
                                </div>
                                {% else %}<!--no badge-->
                                <img src="{% static "GC_Auth/lockCircle.png" %}" alt="lock" class="image"
                                     style="width:150%;height:150%;margin-left: 17px;">
                                <div class="middle">
                                    <div class="text"><strong>Oops!</strong> <br> Badge Locked</div>
                                    <!--text for the hover-->
                                </div>
                            {% endif %}
                        </div>
                    </div>

                    <!--Badge 11: SuperSecurity-->
                    <div class="col-sm-3" style="background-color:white;">

                        <div id="numConnectionsBadge" class="badgehover">
                            <!--coloumn popular profiler-->
                            {% if numConnections >= 1 %}<!--decorator update header-->
                                <img src="{% static "GC_Auth/Badges/decorator2.png" %}" alt="lock" class="image"
                                     style="width:150%;height:150%;margin-left: 17px;">
                                <div class="middle">
                                    <div class="text"><strong>#Selfie</strong> <br> Adding a profile picture</div>
                                    <!--text for the hover-->
                                </div>
                                {% else %}<!--no badge-->
                                <img src="{% static "GC_Auth/lockCircle.png" %}" alt="lock" class="image"
                                     style="width:150%;height:150%;margin-left: 17px;">
                                <div class="middle">
                                    <div class="text"><strong>Oops!</strong> <br> Badge Locked</div>
                                    <!--text for the hover-->
                                </div>
                            {% endif %}
                        </div>
                    </div>

                    <!--Badge 12: -->
                    <div class="col-sm-3" style="background-color:white;">
                        <div class="badgehover">
                            {% load staticfiles %}
                            <img src="{% static "GC_Auth/lockCircle.png" %}" alt="lock" class="image"
                                 style="width:150%;height:150%;margin-left: 17px;">
                            <div class="middle">
                                <div class="text"><strong>Oops!</strong> <br> Badge Locked</div>
                            </div>
                        </div>
                    </div>

                </div>

            </div><!--end modal body-->

        </div>
    </div>
</div>
<!--end of modal-->
<script>

    //Badge_1_Friend_Finder

    var FriendFinder_Connections = firebase.database().ref().child("Users/" + '{{ this_uid }}' + "/Connections");

    FriendFinder_Connections.on("value", function (snapshot) {

        var counter = 0;
        var display = "";
        var display_2 = ""

        snapshot.forEach(function (childSnapshot) {
            counter++;
        });

        if (counter >= 1 && counter < 5) {

            display = "<img src=\"https://firebasestorage.googleapis.com/v0/b/getconnected-9dac0.appspot.com/o/Badges%2Ffriendfinder5.png?alt=media&token=ee0c7bd4-f4b6-492e-a9a0-e45b210b8284\" alt= \"lock\" class=\"image\" style=\"width:150%;height:150%;margin-left: 17px;\">\n" +
                "\n" +
                "                <div class=\"middle\">\n" +
                "                   <div class=\"text\"><strong>Friend Finder</strong> <br> 1 Connection</div>\n" +
                "                 </div>";

            var checkCelebration = firebase.database().ref().child("Users/" + '{{ this_uid }}' + "/Badges");
            checkCelebration.on("value", function (snapshot) {
                var text = "Friend Finder Badge";

                if (snapshot.val().FriendFinder == "not_celebrated") {
                    $('#Congrats_Pop_Up').html(text);
                    $("#Celebrations").modal();
                    //window.alert("hah?");


                    checkCelebration.update({'FriendFinder': "celebrated"});
                }

            });

        } else {

            display = "<img src=\"https://firebasestorage.googleapis.com/v0/b/getconnected-9dac0.appspot.com/o/Badges%2FlockCircle.png?alt=media&token=d204d5fe-9d37-4269-9e73-0a54571a5ce6\" alt= \"lock\" class=\"image\" style=\"width:150%;height:150%;margin-left: 17px;\">\n" +
                "                    <div class=\"middle\">\n" +
                "                        <div class=\"text\"><strong>Oops!</strong> <br> Badge Locked</div>\n" +
                "                         <!--text for the hover-->\n" +
                "                     </div>";
        }

        $('#FriendFinder').html(display);

        //Badge_2_NetoworkingNinja

        if (counter >= 5 && counter < 10) {

            display = "<img src=\"https://firebasestorage.googleapis.com/v0/b/getconnected-9dac0.appspot.com/o/Badges%2FnetworkingNinja.jpg?alt=media&token=a8cac22b-a196-405c-a300-a1e601654717\" style=\"width:150%;height:150%;margin-left: 17px;\">\n" +
                "\n" +
                "                <div class=\"middle\">\n" +
                "                   <div class=\"text\"><strong>Networking Ninja</strong> <br> 5 Connection</div>\n" +
                "                 </div>";

            var checkCelebration = firebase.database().ref().child("Users/" + '{{ this_uid }}' + "/Badges");
            checkCelebration.on("value", function (snapshot) {
                var text = "Networking Ninja Badge";
                if (snapshot.val().NetworkingNinja == "not_celebrated") {
                    $('#Congrats_Pop_Up').html(text);
                    $("#Celebrations").modal();
                    checkCelebration.update({'NetworkingNinja': "celebrated"});


                }

            })

        } else {

            display = "<img src=\"https://firebasestorage.googleapis.com/v0/b/getconnected-9dac0.appspot.com/o/Badges%2FlockCircle.png?alt=media&token=d204d5fe-9d37-4269-9e73-0a54571a5ce6\" alt= \"lock\" class=\"image\" style=\"width:150%;height:150%;margin-left: 17px;\">\n" +
                "                    <div class=\"middle\">\n" +
                "                        <div class=\"text\"><strong>Oops!</strong> <br> Badge Locked</div>\n" +
                "                         <!--text for the hover-->\n" +
                "                     </div>";
        }

        $('#NetworkingNinja').html(display);


        //Badge_3_CrazyConnector

        if (counter >= 10 && counter < 15) {

            display = "<img src=\"https://firebasestorage.googleapis.com/v0/b/getconnected-9dac0.appspot.com/o/Badges%2FcrazyConnector2.png?alt=media&token=98707036-4745-4cfe-a688-f4c7b71a89df\" alt= \"lock\" class=\"image\" style=\"width:150%;height:150%;margin-left: 17px;\">\n" +
                "\n" +
                "                <div class=\"middle\">\n" +
                "                   <div class=\"text\"><strong>Crazy Connector</strong> <br> 10 Connection</div>\n" +
                "                 </div>";

            var checkCelebration = firebase.database().ref().child("Users/" + '{{ this_uid }}' + "/Badges");
            checkCelebration.on("value", function (snapshot) {
                var text = "Crazy Connector Badge";


                if (snapshot.val().CrazyConnector == "not_celebrated") {
                    $('#Congrats_Pop_Up').html(text);
                    $("#Celebrations").modal();
                    checkCelebration.update({'CrazyConnector': "celebrated"});


                }

            })

        } else {

            display = "<img src=\"https://firebasestorage.googleapis.com/v0/b/getconnected-9dac0.appspot.com/o/Badges%2FlockCircle.png?alt=media&token=d204d5fe-9d37-4269-9e73-0a54571a5ce6\" alt= \"lock\" class=\"image\" style=\"width:150%;height:150%;margin-left: 17px;\">\n" +
                "                    <div class=\"middle\">\n" +
                "                        <div class=\"text\"><strong>Oops!</strong> <br> Badge Locked</div>\n" +
                "                         <!--text for the hover-->\n" +
                "                     </div>";
        }

        $('#CrazyConnector').html(display);

        //Badge_4_PopularProfile

        if (counter >= 15) {

            display = "<img src=\"https://firebasestorage.googleapis.com/v0/b/getconnected-9dac0.appspot.com/o/Badges%2FPopularProfiler2.png?alt=media&token=bfed5700-f4ea-4b0f-a992-81346e9fcaee\" style=\"width:150%;height:150%;margin-left: 17px;\">\n" +
                "\n" +
                "                <div class=\"middle\">\n" +
                "                   <div class=\"text\"><strong>Crazy Connector</strong> <br> 15 Connection</div>\n" +
                "                 </div>";

            var checkCelebration = firebase.database().ref().child("Users/" + '{{ this_uid }}' + "/Badges");
            checkCelebration.on("value", function (snapshot) {
                var text = "Popular Profile Badge";

                if (snapshot.val().PopularProfile == "not_celebrated") {
                    $('#Congrats_Pop_Up').html(text);
                    $("#Celebrations").modal();
                    checkCelebration.update({'PopularProfile': "celebrated"});


                }

            })

        } else {

            display = "<img src=\"https://firebasestorage.googleapis.com/v0/b/getconnected-9dac0.appspot.com/o/Badges%2FlockCircle.png?alt=media&token=d204d5fe-9d37-4269-9e73-0a54571a5ce6\" alt= \"lock\" class=\"image\" style=\"width:150%;height:150%;margin-left: 17px;\">\n" +
                "                    <div class=\"middle\">\n" +
                "                        <div class=\"text\"><strong>Oops!</strong> <br> Badge Locked</div>\n" +
                "                         <!--text for the hover-->\n" +
                "                     </div>";
        }

        $('#PopularProfile').html(display);

    });

    //Badge_5_BrightSpark

    var Badges_for_Courses = firebase.database().ref().child("Users/" + '{{ this_uid }}' + "/Courses");

    Badges_for_Courses.on("value", function (snapshot) {

        var counter = 0;
        var display = "";

        snapshot.forEach(function (childSnapshot) {
            counter++;
        });

        if (counter >= 3 && counter < 5) {

            display = "<img src=\"https://firebasestorage.googleapis.com/v0/b/getconnected-9dac0.appspot.com/o/Badges%2FBrigthSpark.png?alt=media&token=2dec1cb8-31d6-4ce5-9519-01dfcd3380b9\" style=\"width:150%;height:150%;margin-left: 17px;\">\n" +
                "\n" +
                "                <div class=\"middle\">\n" +
                "                   <div class=\"text\"><strong>Friend Finder</strong> <br> 3 Courses</div>\n" +
                "                 </div>";

            var checkCelebration = firebase.database().ref().child("Users/" + '{{ this_uid }}' + "/Badges");
            checkCelebration.on("value", function (snapshot) {
                var text = "Bright Spark Badge";

                if (snapshot.val().BrightSpark == "not_celebrated") {
                    $('#Congrats_Pop_Up').html(text);
                    $("#Celebrations").modal();
                    checkCelebration.update({'BrightSpark': "celebrated"});

                }

            })

        } else {

            display = "<img src=\"https://firebasestorage.googleapis.com/v0/b/getconnected-9dac0.appspot.com/o/Badges%2FlockCircle.png?alt=media&token=d204d5fe-9d37-4269-9e73-0a54571a5ce6\" alt= \"lock\" class=\"image\" style=\"width:150%;height:150%;margin-left: 17px;\">\n" +
                "                    <div class=\"middle\">\n" +
                "                        <div class=\"text\"><strong>Oops!</strong> <br> Badge Locked</div>\n" +
                "                         <!--text for the hover-->\n" +
                "                     </div>";
        }

        $('#BrightSpark').html(display);

        //Badge_6_FabAcademic

        if (counter >= 5 && counter < 10) {

            display = "<img src=\"https://firebasestorage.googleapis.com/v0/b/getconnected-9dac0.appspot.com/o/Badges%2FfabAcademic2.png?alt=media&token=d198ff3c-f91a-4e20-90b5-52eba72c7508\" style=\"width:150%;height:150%;margin-left: 17px;\">\n" +
                "\n" +
                "                <div class=\"middle\">\n" +
                "                   <div class=\"text\"><strong>Friend Finder</strong> <br> 5 Courses</div>\n" +
                "                 </div>";

            var checkCelebration = firebase.database().ref().child("Users/" + '{{ this_uid }}' + "/Badges");
            checkCelebration.on("value", function (snapshot) {
                var text = "FabAcademic Badge";


                if (snapshot.val().FabAcademic == "not_celebrated") {
                    $('#Congrats_Pop_Up').html("FabAcademic Badge");
                    $("#Celebrations").modal();
                    checkCelebration.update({'FabAcademic': "celebrated"});


                }

            })

        } else {

            display = "<img src=\"https://firebasestorage.googleapis.com/v0/b/getconnected-9dac0.appspot.com/o/Badges%2FlockCircle.png?alt=media&token=d204d5fe-9d37-4269-9e73-0a54571a5ce6\" alt= \"lock\" class=\"image\" style=\"width:150%;height:150%;margin-left: 17px;\">\n" +
                "                    <div class=\"middle\">\n" +
                "                        <div class=\"text\"><strong>Oops!</strong> <br> Badge Locked</div>\n" +
                "                         <!--text for the hover-->\n" +
                "                     </div>";
        }

        $('#FabAcademic').html(display);

        //Badge_7_Got_Smarter


        if (counter >= 10) {

            display = "<https://firebasestorage.googleapis.com/v0/b/getconnected-9dac0.appspot.com/o/Badges%2FgotSmarter2.png?alt=media&token=3f6b81be-2f2a-41e5-a727-7f48e6e05762\" style=\"width:150%;height:150%;margin-left: 17px;\">\n" +
                "\n" +
                "                <div class=\"middle\">\n" +
                "                   <div class=\"text\"><strong>Friend Finder</strong> <br> 10 Courses</div>\n" +
                "                 </div>";

            var checkCelebration = firebase.database().ref().child("Users/" + '{{ this_uid }}' + "/Badges");
            checkCelebration.on("value", function (snapshot) {
                var text = "GotSmarter Badge";

                if (snapshot.val().GotSmarter == "not_celebrated") {
                    $('#Congrats_Pop_Up').html("GotSmarter Badge");
                    $("#Celebrations").modal();

                    checkCelebration.update({'GotSmarter': "celebrated"});


                }

            })

        } else {

            display = "<img src=\"https://firebasestorage.googleapis.com/v0/b/getconnected-9dac0.appspot.com/o/Badges%2FlockCircle.png?alt=media&token=d204d5fe-9d37-4269-9e73-0a54571a5ce6\" alt= \"lock\" class=\"image\" style=\"width:150%;height:150%;margin-left: 17px;\">\n" +
                "                    <div class=\"middle\">\n" +
                "                        <div class=\"text\"><strong>Oops!</strong> <br> Badge Locked</div>\n" +
                "                         <!--text for the hover-->\n" +
                "                     </div>";
        }

        $('#Got_Smarter').html(display);


    });

    //Badge_8_Got_Smarter

    var locked_one = "";
    locked_one = "<img src=\"https://firebasestorage.googleapis.com/v0/b/getconnected-9dac0.appspot.com/o/Badges%2FlockCircle.png?alt=media&token=d204d5fe-9d37-4269-9e73-0a54571a5ce6\" alt= \"lock\" class=\"image\" style=\"width:150%;height:150%;margin-left: 17px;\">\n" +
        "                    <div class=\"middle\">\n" +
        "                        <div class=\"text\"><strong>Oops!</strong> <br> Badge Locked</div>\n" +
        "                         <!--text for the hover-->\n" +
        "                     </div>";
    $('#locked').html(locked_one);


    //Badge_9_Forum_Boffin

    var Badges_for_Forums = firebase.database().ref().child("Users/" + '{{ this_uid }}' + "/ForumsJoined");

    Badges_for_Forums.on("value", function (snapshot) {

        var counter = 0;
        var display = "";

        snapshot.forEach(function (childSnapshot) {
            counter++;
        });

        if (counter >= 5) {

            display = "<img src=\"https://firebasestorage.googleapis.com/v0/b/getconnected-9dac0.appspot.com/o/Badges%2FforumBoffin2.png?alt=media&token=a31eff4e-d16e-4a1c-a5f6-31cd86f0c6fb\" style=\"width:150%;height:150%;margin-left: 17px;\">\n" +
                "\n" +
                "                <div class=\"middle\">\n" +
                "                   <div class=\"text\"><strong>Forum Boffin</strong> <br> Active in 1 Forum </div>\n" +
                "                 </div>";

            var checkCelebration = firebase.database().ref().child("Users/" + '{{ this_uid }}' + "/Badges");
            checkCelebration.on("value", function (snapshot) {

                if (snapshot.val().ForumBoffin == "not_celebrated") {
                    var text = "GotSmarter Badge";
                    $('#Congrats_Pop_Up').html("ForumBoffin Badge");
                    $("#Celebrations").modal();
                    checkCelebration.update({'ForumBoffin': "celebrated"});

                }

            })

        } else {

            display = "<img src=\"https://firebasestorage.googleapis.com/v0/b/getconnected-9dac0.appspot.com/o/Badges%2FlockCircle.png?alt=media&token=d204d5fe-9d37-4269-9e73-0a54571a5ce6\" alt= \"lock\" class=\"image\" style=\"width:150%;height:150%;margin-left: 17px;\">\n" +
                "                    <div class=\"middle\">\n" +
                "                        <div class=\"text\"><strong>Oops!</strong> <br> Badge Locked</div>\n" +
                "                         <!--text for the hover-->\n" +
                "                     </div>";
        }

        $('#ForumBoffin').html(display);
    });


    //Badge_10_Forum_Boffin


</script>

<!--view all mutuals-->
<div class="modal fade" id="viewmutualsmodal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle"
     aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLongTitle"><strong> View Mutual Connections </strong></h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>

            <div class="modal-body">


                <div class="row" style="margin-bottom: 20px;margin-left: 80px;">
                    {% for names, countries, pictures, bio, conn_id in mutual_connections %}
                        <form action="/goConnectionsOpen/" method="post">
                            <div class="col-md-1"><!--USER PROFILE IMAGE GOES HERE-->
                                <img class="rounded-circle" width="50" height="50"
                                     src="{{ pictures }}"
                                     style="border: 1px solid 	#DCDCDC ; border-radius: 50px;" alt="">
                            </div><!--end col-->

                            <div class="col-md-4"><!--USERNAME AND IF THEY ARE A CONNECTION OR NOT -->
                                <input class="connection_id" id="connection_id" name="connection_id"
                                       value="{{ conn_id }}" hidden style="display: none;">
                                <p>
                                    <button id="{{ conn_id }}_name"
                                            style=" background-color: #FCFCFC;font-family: 'Arial Narrow';border:none;left: 5px; font-weight: bold; font-size: small; top: 5px; position: relative; margin-left:15px;"
                                            onclick="location.href='{% url 'connectionsopen' %}'" type="submit"
                                            value="goConnectionsOpen">
                                        {{ names }}
                                    </button>
                                </p>
                                <p class="badge badge-pill badge-dark"
                                   style="color:white;font-size:10px;margin-left:20px;margin-top:5px;"> {{ countries }} </p>
                            </div><!--end col-->
                        </form>
                        {% if forloop.counter|divisibleby:2 %}
                            </div>
                            <div class="row" style="margin-bottom: 20px; margin-left: 80px;">
                        {% endif %}
                    {% empty %}
                        <p>No Mutual Connections</p>
                    {% endfor %}

                    </div>

            </div> <!--end row-->


        </div>
    </div>
</div>


<!-- End of 1.1 Pop Up modal-->

<!-- Modal for pop up message "forum joined" -->
<div class="modal fade" id="modalForumJoined" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
     aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel"><strong>Forum Joined</strong></h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                You have joined this forum. It's now in your My Forums tab!
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal" style="border: 1px solid gray;
            color: #e83e8c;">Close
                </button>

            </div>
        </div>
    </div>
</div>


<!-- Modal for pop up message "join request sent" -->
<div class="modal fade" id="modalJoinRequestSent" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
     aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel"><strong>Join Request Sent</strong></h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                Your join request has been sent to the forum owner. You will be notified once the owner has accepted
                your request.
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal" style="border: 1px solid gray;
            color: #e83e8c;">Close
                </button>

            </div>
        </div>
    </div>
</div>


<!-- Modal for pop up message "blocked from forum message" -->
<div class="modal fade" id="modalBlockedFromForum" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
     aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel"><strong>Blocked from Forum</strong></h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                Unfortunately, you have been blocked from this forum. Access to this forum is denied.
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal" style="border: 1px solid gray;
            color: #e83e8c;">Close
                </button>

            </div>
        </div>
    </div>
</div>


</body>



