<!DOCTYPE html>
<html lang="en">

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Forums</title>

<head>
    <!--Links to Bootstrap & to css-->

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="../GC_Auth/static/GC_Auth/loginstyle.css">


     <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
     <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>

    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <link href="../../assets/css/ie10-viewport-bug-workaround.css" rel="stylesheet">

    <!-- Footer Bar Style -->
    <link href="sticky-footer.css" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

    <!--NavigationBar Style-->

    <style>

        .dropdown {
            display:inline-block;
            margin-left:20px;
        }

        .glyphicon-bell {
            font-size:1.5rem;
        }

        .notifications {
            min-width:320px;
        }

        .notifications-wrapper {
            overflow:auto;
            max-height:250px;
        }

        .glyphicon-circle-arrow-right {
            margin-left:10px;
        }

        .item-title {
            font-size:1.5rem;
            color: black;
            padding:0px 50px;
        }

        .notifications a.content {
            text-decoration:none;
            background: white;
        }

        .notification-item {
            padding:10px;
            margin:5px;
            background: #ebebeb;
            border-radius:4px;
            height: 80px;
        }

        .profile_img {
            width:25px;
            display:inline;
            float:left;
            border:0px solid #111;
            border-radius:3px;
            box-shadow:0 0 3px rgba(0, 0, 0, 0.5) inset;
        }

         /*footer logo*/
            footer img{


                width:200%;
                height:200%;
               text-align: left;

            }

         .AcceptDeclinebutton {
            border-radius: 8px;
            box-shadow: 0 0 3px rgba(0, 0, 0, 0.1) inset;
            opacity: 0.8;
            padding-top: 3px;
            padding-bottom: 3px;
            padding-left: 5px;
            padding-right: 5px;
            font-size: 12px;
            font-weight: bold;
            background-color: black;
        }

        .AcceptDeclinebutton:hover {
            background-color: #e83e8c;
            color: black;

        }

         .notification-item {
            padding: 5px;
            margin: 5px;
            border-radius: 4px;
            border-width: 5px;
            border-color: black;
            height: 80px;
        }

         .profile_img_1 {
            max-width: 50px;
            min-width: 50px;
            display: inline;
            float: left;
            border: 0px solid #111;
            border-radius: 25px;
            box-shadow: 0 0 3px rgba(0, 0, 0, 0.5) inset;
            margin-right: -20px;

        }



    </style>

</head>
    <body>

        <nav class="navbar navbar-inverse">
            <div class="container-fluid">

                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>  <!--navbar-header-->

                <div class="collapse navbar-collapse" id="myNavbar" > <!--Navigation bar contents-->

                    <!--Left-side (including search ) of navigation bar-->
                    <ul class="nav navbar-nav navbar-left">
                        <li><a onclick="location.href='{% url 'nav_home' %}'"><span class="glyphicon glyphicon-home fa-lg"></span> Home</a></li>
                        <li><a onclick="location.href='{% url 'nav_networks' %}'"><span class="fa fa-globe fa-lg"></span> Connections</a></li>
                        <li><a onclick="location.href='{% url 'nav_forums' %}'" style = "color:white;border-left: 1px solid white;border-right: 1px solid white;"><span class="fa fa-comments-o fa-lg"></span> Forums</a></li>
                        <li><a onclick="location.href='{% url 'nav_courses' %}'"><span class="fa fa-book fa-lg"></span> Courses</a></li>
                    </ul>

                    <ul class="nav navbar-nav" style = "left: 80px; position: relative; width:500px; padding-top: 8px"> <!--Search Input-->

                    </ul>

                    <!--Right-side (including help button ) of navigation bar-->

                    <!--1. User Profile icon + drop down-->

                    <ul class="nav navbar-nav navbar-right" >
                        <li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown" >

                            <span onclick="location.href='{% url 'userprofile' %}'" class="glyphicon glyphicon-user"></span>

                            <span class="glyphicon glyphicon-triangle-bottom"></span></a>

                            <ul class="dropdown-menu">
                                <li><a onclick="location.href='{% url 'settings' %}'">Settings <span class="glyphicon glyphicon-cog pull-right"></span></a></li>
                                <li class="divider"></li>
                                <li><a onclick="location.href='{% url 'nav_forums' %}'">Forums <span class="fa fa-comments-o pull-right"></span></a></li>
                                <li class="divider"></li>

                                <li><a onclick="location.href='{% url 'helpUserProfile' %}'">Help<span class="glyphicon glyphicon-question-sign pull-right"></span></a></li>
                                <li class="divider"></li>
                                <li><a onclick="location.href='{% url 'log' %}'">Sign Out <span class="glyphicon glyphicon-log-out pull-right"></span></a></li>
                            </ul>
                        </li>
                    </ul>

                    <!--1. Notifications icon + drop down-->

                     <ul style="text-decoration: none" class="nav navbar-nav navbar-right ">
                <li style="text-decoration: none" class="dropdown"><a id="idLabel" data-toggle="dropdown"
                                                                      data-target="#" href="#"
                                                                      onclick="CloseIntroForm(); OpenLogIn();">
                    <div id="counter_number_notifications"></div>

                    <ul style="text-decoration: none" class="dropdown-menu notifications" role="menu"
                        aria-labelledby="dLabel">

                        <div class="notifications-wrapper" style="overflow-x: hidden;text-decoration: none">
                            <!--Notifications Dropdown div-->

                            <!-- <input type="button" id="btnGetMessage" value="Get Message"/><br/><br/>-->
                            <ul id="comment"></ul>


                            <!--      <a class="content" href="#">
                                     <div class="notification-item">
                                         <img class="profile_img"
                                              src="http://gravatar.com/avatar/0e1e4e5e5c11835d34c0888921e78fd4?s=80"/>
                                         <h4 class="item-title">James Coden · day ago</h4>
                                         <p class="item-info">Marketing 101, Video Assignment</p>
                                     </div>
                                 </a>-->


                        </div><!--End of Notifications Dropdown div-->

                        <!--Footer of notification drop down-->
                        <li class="divider"></li>
                        <li style="text-align: center"><a href="#">View All </a></li>

                    </ul> <!--Dropdown menu Notification-->
                </a></li><!--dropdown -->
            </ul> <!--nav navbar-nav navbar-right-->


                    <!--2. Message icon + drop down-->

                    <ul class="nav navbar-nav navbar-right ">
                        <li class="dropdown"><a id="idMessage" data-toggle="dropdown" data-target="#" href="#" onclick="CloseIntroForm(); OpenLogIn();">
                            <span class="glyphicon glyphicon-envelope"></span> </a>

                            <ul class="dropdown-menu notifications" role="menu" aria-labelledby="dLabel">

                                <div class="notifications-wrapper"> <!--Messages Dropdown div-->

                                    <a class="content" href="#">
                                        <div class="notification-item">
                                            <img class="profile_img" src="http://gravatar.com/avatar/0e1e4e5e5c11835d34c0888921e78fd4?s=80" />
                                            <h4 class="item-title">James Coden · day ago</h4>
                                            <p class="item-info">Marketing 101, Video Assignment</p>
                                        </div>

                                    </a>

                                    <a class="content" href="#">
                                        <div class="notification-item">
                                            <img class="profile_img" src="http://gravatar.com/avatar/0e1e4e5e5c11835d34c0888921e78fd4?s=80" />
                                            <h4 class="item-title">James Coden · day ago</h4>
                                            <p class="item-info">Marketing 101, Video Assignment</p>
                                        </div>

                                    </a>

                                    <a class="content" href="#">
                                        <div class="notification-item">
                                            <img class="profile_img" src="http://gravatar.com/avatar/0e1e4e5e5c11835d34c0888921e78fd4?s=80" />
                                            <h4 class="item-title">James Coden · day ago</h4>
                                            <p class="item-info">Marketing 101, Video Assignment</p>
                                        </div>
                                    </a>

                                    <a class="content" href="#">
                                        <div class="notification-item">
                                            <img class="profile_img" src="http://gravatar.com/avatar/0e1e4e5e5c11835d34c0888921e78fd4?s=80" />
                                            <h4 class="item-title">James Coden · day ago</h4>
                                            <p class="item-info">Marketing 101, Video Assignment</p>
                                        </div>
                                    </a>

                                    <a class="content" href="#">
                                        <div class="notification-item">
                                            <img class="profile_img" src="http://gravatar.com/avatar/0e1e4e5e5c11835d34c0888921e78fd4?s=80" />
                                            <h4 class="item-title">James Coden · day ago</h4>
                                            <p class="item-info">Marketing 101, Video Assignment</p>
                                        </div>
                                    </a>

                                    <a class="content" href="#">
                                        <div class="notification-item">
                                            <img class="profile_img" src="http://gravatar.com/avatar/0e1e4e5e5c11835d34c0888921e78fd4?s=80" />
                                            <h4 class="item-title">James Coden · day ago</h4>
                                            <p class="item-info">Marketing 101, Video Assignment</p>
                                        </div>
                                    </a>

                                </div><!--End of Messages Dropdown div-->
                                <li class="divider"></li>
                                <li><a href="#">View All <span class="glyphicon glyphicon-circle-arrow-right"></span></a></li>

                            </ul><!--Dropdown menu Messages-->
                        </li><!--dropdown -->
                    </ul> <!--nav navbar-nav navbar-right-->
                </div><!--collapse nav-bar collapse-->
            </div><!--container fluid-->
        </nav><!--nav navbar-inverse-->


        <!--HELP BUTTON-->
            <a href="Courses.html"><span class=" fa fa-question-circle fa-lg" style="position: absolute; left: 1350px; font-size: medium; top: 60px;"> Help</span></a>

    <div class="wireframes" style="text-align: center;">
        <!--wireframe-->
     {% load staticfiles %}

                    <img src="{% static "GC_Auth/Wireframes/Forums_wireframes.png" %}" alt= "lock" class="image" onclick="location.href='{% url 'forumsopen' %}'" style="width:55%; height:55%;display: inline-block;" >

    </div>
<br>
<!--footer-->
    <footer class="page-footer font-small cyan darken-3" style="background-color: #D3D3D3;">


    <div class="container">
        <br></br>
        <!-- Call to action -->
        <ul class="list-unstyled list-inline text-center py-2">
            <li class="list-inline-item">
                <!--  <h5 class="mb-1">Log in now: </h5>-->
            </li>
            <li class="list-inline-item">





                <div class="row" ><!--table row-->

                    <div class="col-sm-3"  style="text-align:left;padding-right: 100px;">
                        <br>
                    {% load staticfiles %}
                        <img src="{% static "GC_Auth/logotrans.png" %}" alt= "lock" class="image" >
                    </div>


                        <div class="col-sm-3"  style="text-align:left;padding-left: 120px;">

                          <p style="color:#e83e8c;font-size:20px;"><strong>Menu</strong></p>
                                <a onclick="location.href='{% url 'nav_home' %}'" style="color: white"> <p>Home</p></a>
                                <a onclick="location.href='{% url 'nav_networks' %}'" style="color: white"> <p>Connections</p></a>
                                <a onclick="location.href='{% url 'nav_forums' %}'" style="color: white"> <p>Forums</p></a>
                                <a onclick="location.href='{% url 'nav_courses' %}'"  style="color: white"> <p>Courses</p></a>
                         </div>

                    <div class="col-sm-3" style="text-align:left;padding-left: 80px;"><!--coloumn-->

                              <p style="color:#e83e8c;font-size:20px;"><strong>Help & FAQs</strong></p>

                                <a onclick="location.href='{% url 'introHelp' %}'" style="color: white"> <p>What is GetConnected?</p></a>
                                <a onclick="location.href='{% url 'accountHelp' %}'" style="color: white"> <p>Your Account</p></a>
                                <a onclick="location.href='{% url 'nav_home' %}'" style="color: white"> <p>Forum Help</p></a>
                                <a onclick="location.href='{% url 'nav_home' %}'" style="color: white"> <p>Connection Management</p></a>
                               <a onclick="location.href='{% url 'nav_home' %}'"style="color: white"> <p>Messaging</p></a>
                         <a href="https://www.getsmarter.com/what-we-do" style="color: white"> <p>GetSmarter</p></a>



                         </div>

                      <div class="col-sm-3" style="text-align:left;padding-left: 80px;"><!--coloumn-->

                              <p style="color:#e83e8c;font-size:20px;"><strong>Contact Us</strong></p>
                             <p style="color:white;"><strong>Tel: </strong> 456 4637</p>
                                <p style="color:white;"> <strong>Email: </strong> getConnected@GetSmarter.co.za</p>
                                 <p style="color:white;"><strong>Working Hours:</strong> Mon - Fri, 09:00 - 17:00</p>





                         </div>



                </div>

                <br>
                 <br>


            </li>
        </ul>
        <!-- Call to action -->

    </div>
    </div>
</footer>


    <script>
    // Fetching the date
             const MONTH_NAMES = [
                'January', 'February', 'March', 'April', 'May', 'June',
                'July', 'August', 'September', 'October', 'November', 'December'
            ];


            function getFormattedDate(date, prefomattedDate = false, hideYear = false) {
                const day = date.getDate();
                const month = MONTH_NAMES[date.getMonth()];
                const year = date.getFullYear();
                const hours = date.getHours();
                let minutes = date.getMinutes();

                if (minutes < 10) {
                    // Adding leading zero to minutes
                    minutes = `0${minutes}`;
                }

                if (prefomattedDate) {
                    // Today at 10:20
                    // Yesterday at 10:20
                    return `${prefomattedDate} at ${hours}:${minutes}`;
                }

                if (hideYear) {
                    // 10. January at 10:20
                    return `${day}. ${month} at ${hours}:${minutes}`;
                }

                // 10. January 2017. at 10:20
                return `${day}. ${month} ${year}. at ${hours}:${minutes}`;
            }


            // --- Main function
            function timeAgo(dateParam) {

                if (!dateParam) {
                    return null;
                }

                const date = typeof dateParam === 'object' ? dateParam : new Date(dateParam);
                const DAY_IN_MS = 86400000; // 24 * 60 * 60 * 1000
                const today = new Date();
                const yesterday = new Date(today - DAY_IN_MS);
                const seconds = Math.round((today - date) / 1000);
                const minutes = Math.round(seconds / 60);
                const isToday = today.toDateString() === date.toDateString();
                const isYesterday = yesterday.toDateString() === date.toDateString();
                const isThisYear = today.getFullYear() === date.getFullYear();


                if (seconds < 5) {
                    return 'now';
                } else if (seconds < 60) {
                    return `${seconds} seconds ago`;
                } else if (seconds < 90) {
                    return 'about a minute ago';
                } else if (minutes < 60) {
                    return `${minutes} minutes ago`;
                } else if (isToday) {
                    return getFormattedDate(date, 'Today'); // Today at 10:20
                } else if (isYesterday) {
                    return getFormattedDate(date, 'Yesterday'); // Yesterday at 10:20
                } else if (isThisYear) {
                    return getFormattedDate(date, false, true); // 10. January at 10:20
                }

                return getFormattedDate(date); // 10. January 2017. at 10:20
            };

    // Realtime Updates

    var database_counter = firebase.database().ref().child("Users/{{this_uid}}/RequestsReceived");/*current user's account*/
    database_counter.on('value', function (snapshot) {
        renderCount(snapshot.val());
        renderUI(snapshot.val());
    })


    function renderUI(obj) {
                var html = '';
                var keys = Object.keys(obj);
                for (var i = keys.length - 1; i >= 0; i--) {
               // for (var i = 0; i <= keys.length - 1; i++) {


                    /* html += "<li><b><i>" + obj[keys[i]].time + "</i></b> girl " + obj[keys[i]].receiver + "</li>";*/
                    /*Creating notification item*/

                    if (obj[keys[i]].sender_profilePic != undefined) {

                        var display_time = obj[keys[i]].time;
                        display_time = Number(display_time); // cast it to a Number
                        var ts_display = timeAgo(display_time);


                        var decision = "true";
                        var opp_decison = "false";
                        html += "<div href=\"#\" class=\"content\" style=\"top: -10px; position:relative;text-decoration: none\"> <div style=\"text-decoration: none\" class=\"notification-item\"><img  class=\"profile_img_1\" src=\" " + obj[keys[i]].sender_profilePic + "\"/> <p style=\"margin-left: 155px;font-size: 60%; color: darkgray;text-decoration: none\">" + ts_display + "&nbsp;&nbsp;<i style=\"color: black;\"onclick=\"Accept_request(" + "\'" + obj[keys[i]].sender_id + "\'" + "," + "\'" + obj[keys[i]].sender + "\'" + "," + "\'" + obj[keys[i]].post_id + "\'" + "," + opp_decison + ")\" class=\"fa fa-close\"></i></p> <h5 style=\"color: black; margin-top: -15px; left: 25px; position:relative\">" + obj[keys[i]].sender + "</h5> <p style=\"color: black; margin-top: -10px;left: 25px;position:relative; font-size:small\">" + obj[keys[i]].message +
                            "</p> <div style=\"margin-top: -10px\"> <button  id=\"dntrigger\" onclick=\"Accept_request(" + "\'" + obj[keys[i]].sender_id + "\'" + "," + "\'" + obj[keys[i]].sender + "\'" + "," + "\'" + obj[keys[i]].post_id + "\'" + "," + decision + " )\" class=\"AcceptDeclinebutton\" style=\" font-size: 85%; position: relative;left: 80px;color: white\">Accept</button> <button id=\"DeclineRemove\" onclick=\"Accept_request(" + "\'" + obj[keys[i]].sender_id + "\'" + "," + "\'" + obj[keys[i]].sender + "\'" + "," + "\'" + obj[keys[i]].post_id + "\'" + "," + opp_decison + ")\" class=\"AcceptDeclinebutton\" style=\"; font-size: 85%;position: relative;left: 80px;color: white \">Decline </button> </div> <hr style=\"width: 100%; color: gray; height: 2px; background-color:grey; margin-top: 5px\"/> </div> </div>";


                    }}
                $('#comment').html(html);
            }


            function renderCount(obj) {
                var html = '';
                var countholder = 0;

                var keys = Object.keys(obj);
                for (var i = 0; i < keys.length; i++) {
                    countholder++;
                }
                countholder--;
                database_counter.update({'counter': countholder});
                 /*Creating notification icon*/


                html += "<span class=\"glyphicon glyphicon-bell\"></span>&nbsp;<span class=\"label label-default\" style=\"background-color: red;color: white\">" + countholder + "</span></a>";


                $('#counter_number_notifications').html(html);


            }


              function Accept_request(sender_id, name, post_id,isAccept){


                  if (String(isAccept).valueOf() == String("true").valueOf()) {
                      var AddConnection = firebase.database().ref().child("Users/" + '{{this_uid}}' + "/Connections");/*Messages*/
                      var AddConnection_other = firebase.database().ref().child("Users/" + sender_id + "/Connections");/*Messages*/


                      //AddConnection.child(sender_id).set(name);
                      var bio;
                      var propic;
                      var country;
                      var getAcceptcon = firebase.database().ref().child("Users/" + sender_id);
                      getAcceptcon.on("value", function (snapshot) {
                          bio = snapshot.val().Bio;
                          propic = snapshot.val().ProfilePic;
                          country = snapshot.val().Country;
                      });

                      //var created_id_target = AddConnection.push();
                      AddConnection.child(sender_id).set({ /*Pushes to receiver*/
                          Name: name,
                          Bio: bio,
                          ProfilePic: propic,
                          Country: country,

                      });

                      AddConnection_other.child('{{this_uid}}').set({ /*Pushes to receiver*/
                          Name: '{{ n }}',
                          Bio: '{{ bio }}',
                          ProfilePic: '{{ ProfilePic }}',
                          Country: '{{ my_country }}',

                      });


                      window.alert("You are now connected with " + name);


                  }
                  var different_name = firebase.database().ref().child("Users/" + '{{this_uid}}' + "/RequestsReceived/" + post_id);/*Messages*/
                  different_name.remove();

                  var removesent = firebase.database().ref().child("Users/" + post_id + "/RequestsSent/" + '{{this_uid}}');/*Messages*/
                  removesent.remove();
              }






</script>

    </body>